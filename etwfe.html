<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Introduction to etwfe</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <style>
    :root { --accent: #2563eb; --green: #059669; --code-bg: #1e1e2e; --border: #e5e5e5; --text: #1a1a1a; --muted: #666; }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Inter', sans-serif; font-size: 15px; line-height: 1.75; color: var(--text); max-width: 800px; margin: 0 auto; padding: 32px 24px 64px; }
    a { color: var(--accent); text-decoration: none; }
    a:hover { text-decoration: underline; }
    
    header { margin-bottom: 40px; padding-bottom: 24px; border-bottom: 1px solid var(--border); }
    .pkg-name { font-family: 'JetBrains Mono', monospace; font-size: 2rem; font-weight: 700; margin-bottom: 8px; }
    .pkg-desc { color: var(--muted); font-size: 1.1rem; margin-bottom: 16px; }
    .header-links { display: flex; gap: 16px; font-size: 14px; flex-wrap: wrap; }
    .header-links a { display: flex; align-items: center; gap: 5px; }
    .header-links svg { width: 16px; height: 16px; }

    h2 { font-size: 1.35rem; font-weight: 700; margin: 48px 0 16px; padding-bottom: 8px; border-bottom: 1px solid var(--border); }
    h3 { font-size: 1.05rem; font-weight: 600; margin: 32px 0 12px; color: #333; }
    p { margin-bottom: 16px; }
    p code, li code { background: #f3f4f6; padding: 2px 6px; border-radius: 4px; font-family: 'JetBrains Mono', monospace; font-size: 13px; }

    .validated { background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%); border: 1px solid #a7f3d0; border-radius: 10px; padding: 16px 20px; margin: 24px 0; font-size: 13px; color: #065f46; display: flex; align-items: center; gap: 14px; }
    .validated svg { width: 24px; height: 24px; flex-shrink: 0; }

    .code { background: var(--code-bg); border-radius: 10px; margin: 16px 0; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
    .code-head { display: flex; justify-content: space-between; align-items: center; padding: 10px 16px; background: rgba(255,255,255,0.05); border-bottom: 1px solid rgba(255,255,255,0.08); font-family: 'JetBrains Mono', monospace; font-size: 11px; color: #6c7086; text-transform: uppercase; }
    .copy-btn { background: rgba(255,255,255,0.08); border: none; color: #a6adc8; padding: 5px 14px; border-radius: 5px; font-size: 11px; cursor: pointer; }
    .copy-btn:hover { background: rgba(255,255,255,0.15); color: #cdd6f4; }
    pre { margin: 0; padding: 18px; overflow-x: auto; }
    pre code { font-family: 'JetBrains Mono', monospace; font-size: 13px; line-height: 1.7; color: #cdd6f4; background: none; padding: 0; }
    .k { color: #cba6f7; } .s { color: #a6e3a1; } .f { color: #89b4fa; } .c { color: #6c7086; font-style: italic; } .n { color: #fab387; }

    .out { background: #fafafa; border: 1px solid #e5e5e5; border-radius: 10px; padding: 16px 18px; margin: 16px 0; font-family: 'JetBrains Mono', monospace; font-size: 12px; overflow-x: auto; }
    .out-label { font-size: 10px; font-weight: 600; text-transform: uppercase; color: #888; margin-bottom: 12px; }
    .out table { width: 100%; border-collapse: collapse; }
    .out th, .out td { text-align: left; padding: 8px 12px; }
    .out th { font-weight: 600; border-bottom: 2px solid #ddd; color: #333; }
    .out td { border-bottom: 1px solid #eee; }
    .out tr:last-child td { border-bottom: none; }
    .out .r { text-align: right; font-variant-numeric: tabular-nums; }

    .plot-container { background: #fff; border: 1px solid #e2e8f0; border-radius: 12px; margin: 28px 0; overflow: hidden; }
    .plot-header { background: #f8fafc; padding: 14px 20px; border-bottom: 1px solid #e2e8f0; }
    .plot-title { font-size: 13px; font-weight: 600; color: #1e293b; }
    .plot-subtitle { font-size: 11px; color: #64748b; margin-top: 2px; }
    .plot-body { padding: 20px; background: #fff; }
    .plot-body svg { display: block; margin: 0 auto; max-width: 100%; height: auto; }
    .plot-footer { background: #f8fafc; padding: 12px 20px; border-top: 1px solid #e2e8f0; font-size: 11px; color: #64748b; }

    .cols-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
    @media (max-width: 640px) { .cols-2 { grid-template-columns: 1fr; } }

    .ref { font-size: 14px; color: var(--muted); line-height: 1.9; }
    footer { margin-top: 56px; padding-top: 24px; border-top: 1px solid var(--border); text-align: center; font-size: 13px; color: var(--muted); }
    footer a { margin: 0 8px; }
  </style>
</head>
<body>

  <header>
    <div class="pkg-name">Introduction to etwfe</div>
    <p class="pkg-desc">Extended Two-Way Fixed Effects for Python</p>
    <div class="header-links">
      <a href="index.html">← Back to site</a>
      <a href="https://pypi.org/project/etwfe/">PyPI</a>
      <a href="https://github.com/armandkapllani/etwfe">GitHub</a>
    </div>
  </header>

  <h2>Background</h2>
  <p>
    A foundational approach in applied economics is the difference-in-differences (DiD) design. The core intuition is straightforward: estimate treatment effects by comparing how outcomes change over time for units that received an intervention versus those that didn't.
  </p>
  <p>
    This TWFE approach is elegant and intuitive—but recent econometric research has revealed serious problems. When treatment timing varies across units (staggered adoption), the standard TWFE estimator can assign perverse negative weights to certain treatment effects.
  </p>
  <p>
    Wooldridge (2021, 2023) proposed an intuitive solution: instead of a single treatment indicator, saturate the model with the full set of cohort-by-time interactions. The <code>etwfe</code> package automates this approach.
  </p>

  <h2>Dataset</h2>
  <p>
    We'll use county-level panel data on teen employment. The dataset tracks 500 US counties over 2003–2007, studying how minimum wage increases affected employment.
  </p>

  <div class="code">
    <div class="code-head"><span>python</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
    <pre><code><span class="k">from</span> etwfe <span class="k">import</span> etwfe
<span class="k">import</span> pyreadr

<span class="c"># Load mpdta dataset</span>
url = <span class="s">"https://github.com/bcallaway11/did/raw/master/data/mpdta.rda"</span>
mpdta = pyreadr.<span class="f">read_r</span>(url)[<span class="s">"mpdta"</span>]
mpdta[<span class="s">"first_treat"</span>] = mpdta[<span class="s">"first.treat"</span>].<span class="f">astype</span>(<span class="n">int</span>)</code></pre>
  </div>

  <h2>Basic Usage</h2>

  <div class="code">
    <div class="code-head"><span>python</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
    <pre><code>mod = <span class="f">etwfe</span>(
    fml=<span class="s">"lemp ~ lpop"</span>,
    tvar=<span class="s">"year"</span>,
    gvar=<span class="s">"first_treat"</span>,
    data=mpdta,
    vcov={<span class="s">"CRV1"</span>: <span class="s">"countyreal"</span>}
)

<span class="c"># Simple ATT</span>
mod.<span class="f">emfx</span>()</code></pre>
  </div>

  <div class="out">
    <div class="out-label">Average Treatment Effect on the Treated</div>
    <table>
      <tr><th>term</th><th class="r">estimate</th><th class="r">std.error</th><th class="r">conf.low</th><th class="r">conf.high</th></tr>
      <tr><td>.Dtreat</td><td class="r">-0.0506</td><td class="r">0.0125</td><td class="r">-0.0751</td><td class="r">-0.0261</td></tr>
    </table>
  </div>

  <div class="code">
    <div class="code-head"><span>python</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
    <pre><code><span class="c"># Event study</span>
mod.<span class="f">emfx</span>(type=<span class="s">"event"</span>)</code></pre>
  </div>

  <div class="out">
    <div class="out-label">Event Study</div>
    <table>
      <tr><th class="r">event</th><th class="r">estimate</th><th class="r">std.error</th><th class="r">conf.low</th><th class="r">conf.high</th></tr>
      <tr><td class="r">0</td><td class="r">-0.0332</td><td class="r">0.0134</td><td class="r">-0.0594</td><td class="r">-0.0070</td></tr>
      <tr><td class="r">1</td><td class="r">-0.0573</td><td class="r">0.0171</td><td class="r">-0.0910</td><td class="r">-0.0237</td></tr>
      <tr><td class="r">2</td><td class="r">-0.1379</td><td class="r">0.0308</td><td class="r">-0.1982</td><td class="r">-0.0775</td></tr>
      <tr><td class="r">3</td><td class="r">-0.1095</td><td class="r">0.0323</td><td class="r">-0.1729</td><td class="r">-0.0462</td></tr>
    </table>
  </div>

  <h2>Visualization</h2>

  <div class="code">
    <div class="code-head"><span>python</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
    <pre><code>mod.<span class="f">plot</span>(type=<span class="s">"event"</span>)</code></pre>
  </div>

  <div class="plot-container">
    <div class="plot-header">
      <div class="plot-title">Event Study</div>
      <div class="plot-subtitle">Post-treatment effects only (cgroup="notyet")</div>
    </div>
    <div class="plot-body">
      <svg viewBox="0 0 400 240" xmlns="http://www.w3.org/2000/svg">
        <rect x="50" y="20" width="320" height="180" fill="#fff" stroke="#e5e7eb"/>
        <g stroke="#f3f4f6"><line x1="50" y1="56" x2="370" y2="56"/><line x1="50" y1="92" x2="370" y2="92"/><line x1="50" y1="128" x2="370" y2="128"/><line x1="50" y1="164" x2="370" y2="164"/></g>
        <line x1="50" y1="56" x2="370" y2="56" stroke="#94a3b8" stroke-dasharray="4,3"/>
        <text x="42" y="24" font-size="9" fill="#6b7280" text-anchor="end">0.05</text>
        <text x="42" y="60" font-size="9" fill="#6b7280" text-anchor="end">0</text>
        <text x="42" y="96" font-size="9" fill="#6b7280" text-anchor="end">−0.05</text>
        <text x="42" y="132" font-size="9" fill="#6b7280" text-anchor="end">−0.10</text>
        <text x="42" y="168" font-size="9" fill="#6b7280" text-anchor="end">−0.15</text>
        <text x="42" y="204" font-size="9" fill="#6b7280" text-anchor="end">−0.20</text>
        <text x="110" y="215" font-size="9" fill="#6b7280" text-anchor="middle">0</text>
        <text x="190" y="215" font-size="9" fill="#6b7280" text-anchor="middle">1</text>
        <text x="270" y="215" font-size="9" fill="#6b7280" text-anchor="middle">2</text>
        <text x="350" y="215" font-size="9" fill="#6b7280" text-anchor="middle">3</text>
        <g stroke="#2563eb" stroke-width="1.2">
          <line x1="110" y1="99" x2="110" y2="61"/><line x1="105" y1="99" x2="115" y2="99"/><line x1="105" y1="61" x2="115" y2="61"/>
          <line x1="190" y1="121" x2="190" y2="73"/><line x1="185" y1="121" x2="195" y2="121"/><line x1="185" y1="73" x2="195" y2="73"/>
          <line x1="270" y1="199" x2="270" y2="112"/><line x1="265" y1="199" x2="275" y2="199"/><line x1="265" y1="112" x2="275" y2="112"/>
          <line x1="350" y1="180" x2="350" y2="89"/><line x1="345" y1="180" x2="355" y2="180"/><line x1="345" y1="89" x2="355" y2="89"/>
        </g>
        <circle cx="110" cy="80" r="3" fill="#2563eb"/>
        <circle cx="190" cy="97" r="3" fill="#2563eb"/>
        <circle cx="270" cy="155" r="3" fill="#2563eb"/>
        <circle cx="350" cy="135" r="3" fill="#2563eb"/>
        <text x="210" y="230" font-size="9" fill="#6b7280" text-anchor="middle">Event time</text>
      </svg>
    </div>
    <div class="plot-footer">Effects grow over time, reaching −13.8% at event time 2.</div>
  </div>

  <p>To examine pre-treatment trends, use never-treated as controls:</p>

  <div class="code">
    <div class="code-head"><span>python</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
    <pre><code>mod_never = <span class="f">etwfe</span>(
    fml=<span class="s">"lemp ~ lpop"</span>, tvar=<span class="s">"year"</span>, gvar=<span class="s">"first_treat"</span>,
    data=mpdta, vcov={<span class="s">"CRV1"</span>: <span class="s">"countyreal"</span>},
    cgroup=<span class="s">"never"</span>
).<span class="f">emfx</span>(type=<span class="s">"event"</span>)

mod_never.<span class="f">plot</span>()</code></pre>
  </div>

  <div class="plot-container">
    <div class="plot-header">
      <div class="plot-title">Event Study with Pre-Treatment</div>
      <div class="plot-subtitle">Using never-treated as control group</div>
    </div>
    <div class="plot-body">
      <svg viewBox="0 0 480 260" xmlns="http://www.w3.org/2000/svg">
        <rect x="50" y="20" width="400" height="200" fill="#fff" stroke="#e5e7eb"/>
        <g stroke="#f3f4f6"><line x1="50" y1="48" x2="450" y2="48"/><line x1="50" y1="77" x2="450" y2="77"/><line x1="50" y1="135" x2="450" y2="135"/><line x1="50" y1="163" x2="450" y2="163"/><line x1="50" y1="192" x2="450" y2="192"/></g>
        <line x1="50" y1="77" x2="450" y2="77" stroke="#94a3b8" stroke-dasharray="4,3"/>
        <line x1="250" y1="20" x2="250" y2="220" stroke="#dc2626" stroke-dasharray="3,3"/>
        <text x="42" y="22" font-size="9" fill="#6b7280" text-anchor="end">0.10</text>
        <text x="42" y="51" font-size="9" fill="#6b7280" text-anchor="end">0.05</text>
        <text x="42" y="80" font-size="9" fill="#6b7280" text-anchor="end">0</text>
        <text x="42" y="109" font-size="9" fill="#6b7280" text-anchor="end">−0.05</text>
        <text x="42" y="138" font-size="9" fill="#6b7280" text-anchor="end">−0.10</text>
        <text x="42" y="167" font-size="9" fill="#6b7280" text-anchor="end">−0.15</text>
        <text x="42" y="196" font-size="9" fill="#6b7280" text-anchor="end">−0.20</text>
        <text x="100" y="235" font-size="9" fill="#6b7280" text-anchor="middle">−4</text>
        <text x="150" y="235" font-size="9" fill="#6b7280" text-anchor="middle">−3</text>
        <text x="200" y="235" font-size="9" fill="#6b7280" text-anchor="middle">−2</text>
        <text x="250" y="235" font-size="9" fill="#6b7280" text-anchor="middle">−1</text>
        <text x="300" y="235" font-size="9" fill="#6b7280" text-anchor="middle">0</text>
        <text x="350" y="235" font-size="9" fill="#6b7280" text-anchor="middle">1</text>
        <text x="400" y="235" font-size="9" fill="#6b7280" text-anchor="middle">2</text>
        <text x="450" y="235" font-size="9" fill="#6b7280" text-anchor="middle">3</text>
        <!-- Pre-treatment (gray): -4: 0.007(-0.040,0.054), -3: 0.028(-0.009,0.065), -2: 0.023(-0.006,0.052) -->
        <g stroke="#9ca3af" stroke-width="1.2">
          <line x1="100" y1="100" x2="100" y2="46"/><line x1="95" y1="100" x2="105" y2="100"/><line x1="95" y1="46" x2="105" y2="46"/>
          <line x1="150" y1="82" x2="150" y2="39"/><line x1="145" y1="82" x2="155" y2="82"/><line x1="145" y1="39" x2="155" y2="39"/>
          <line x1="200" y1="80" x2="200" y2="47"/><line x1="195" y1="80" x2="205" y2="80"/><line x1="195" y1="47" x2="205" y2="47"/>
        </g>
        <circle cx="100" cy="73" r="3" fill="#9ca3af"/>
        <circle cx="150" cy="61" r="3" fill="#9ca3af"/>
        <circle cx="200" cy="63" r="3" fill="#9ca3af"/>
        <circle cx="250" cy="77" r="2" fill="#6b7280"/>
        <!-- Post-treatment (blue): 0: -0.021(-0.046,0.004), 1: -0.053(-0.086,-0.020), 2: -0.141(-0.202,-0.080), 3: -0.108(-0.175,-0.041) -->
        <g stroke="#2563eb" stroke-width="1.2">
          <line x1="300" y1="103" x2="300" y2="74"/><line x1="295" y1="103" x2="305" y2="103"/><line x1="295" y1="74" x2="305" y2="74"/>
          <line x1="350" y1="127" x2="350" y2="89"/><line x1="345" y1="127" x2="355" y2="127"/><line x1="345" y1="89" x2="355" y2="89"/>
          <line x1="400" y1="193" x2="400" y2="123"/><line x1="395" y1="193" x2="405" y2="193"/><line x1="395" y1="123" x2="405" y2="123"/>
          <line x1="450" y1="178" x2="450" y2="101"/><line x1="445" y1="178" x2="455" y2="178"/><line x1="445" y1="101" x2="455" y2="101"/>
        </g>
        <circle cx="300" cy="89" r="3" fill="#2563eb"/>
        <circle cx="350" cy="108" r="3" fill="#2563eb"/>
        <circle cx="400" cy="158" r="3" fill="#2563eb"/>
        <circle cx="450" cy="139" r="3" fill="#2563eb"/>
        <text x="250" y="250" font-size="9" fill="#6b7280" text-anchor="middle">Event time</text>
      </svg>
    </div>
    <div class="plot-footer">Pre-treatment effects (gray) near zero support parallel trends. Post-treatment effects (blue) are negative.</div>
  </div>

  <div class="code">
    <div class="code-head"><span>python</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
    <pre><code>mod_never.<span class="f">plot</span>(type=<span class="s">"ribbon"</span>, color=<span class="s">"darkcyan"</span>)</code></pre>
  </div>

  <div class="plot-container">
    <div class="plot-header">
      <div class="plot-title">Minimum wage effect on teen employment</div>
      <div class="plot-subtitle">Ribbon style, never-treated as controls</div>
    </div>
    <div class="plot-body">
      <svg viewBox="0 0 480 260" xmlns="http://www.w3.org/2000/svg">
        <rect x="50" y="20" width="400" height="200" fill="#fff" stroke="#e5e7eb"/>
        <g stroke="#f3f4f6"><line x1="50" y1="48" x2="450" y2="48"/><line x1="50" y1="77" x2="450" y2="77"/><line x1="50" y1="135" x2="450" y2="135"/><line x1="50" y1="163" x2="450" y2="163"/><line x1="50" y1="192" x2="450" y2="192"/></g>
        <line x1="50" y1="77" x2="450" y2="77" stroke="#94a3b8" stroke-dasharray="4,3"/>
        <line x1="250" y1="20" x2="250" y2="220" stroke="#94a3b8" stroke-dasharray="3,3"/>
        <text x="42" y="22" font-size="9" fill="#6b7280" text-anchor="end">0.10</text>
        <text x="42" y="51" font-size="9" fill="#6b7280" text-anchor="end">0.05</text>
        <text x="42" y="80" font-size="9" fill="#6b7280" text-anchor="end">0</text>
        <text x="42" y="109" font-size="9" fill="#6b7280" text-anchor="end">−0.05</text>
        <text x="42" y="138" font-size="9" fill="#6b7280" text-anchor="end">−0.10</text>
        <text x="42" y="167" font-size="9" fill="#6b7280" text-anchor="end">−0.15</text>
        <text x="42" y="196" font-size="9" fill="#6b7280" text-anchor="end">−0.20</text>
        <text x="100" y="235" font-size="9" fill="#6b7280" text-anchor="middle">−4</text>
        <text x="150" y="235" font-size="9" fill="#6b7280" text-anchor="middle">−3</text>
        <text x="200" y="235" font-size="9" fill="#6b7280" text-anchor="middle">−2</text>
        <text x="250" y="235" font-size="9" fill="#6b7280" text-anchor="middle">−1</text>
        <text x="300" y="235" font-size="9" fill="#6b7280" text-anchor="middle">0</text>
        <text x="350" y="235" font-size="9" fill="#6b7280" text-anchor="middle">1</text>
        <text x="400" y="235" font-size="9" fill="#6b7280" text-anchor="middle">2</text>
        <text x="450" y="235" font-size="9" fill="#6b7280" text-anchor="middle">3</text>
        <polygon points="100,46 150,39 200,47 250,77 300,74 350,89 400,123 450,101 450,178 400,193 350,127 300,103 250,77 200,80 150,82 100,100" fill="#008b8b" opacity="0.2"/>
        <polyline points="100,73 150,61 200,63 250,77 300,89 350,108 400,158 450,139" fill="none" stroke="#008b8b" stroke-width="1.5"/>
        <circle cx="100" cy="73" r="2.5" fill="#008b8b"/>
        <circle cx="150" cy="61" r="2.5" fill="#008b8b"/>
        <circle cx="200" cy="63" r="2.5" fill="#008b8b"/>
        <circle cx="250" cy="77" r="2" fill="#6b7280"/>
        <circle cx="300" cy="89" r="2.5" fill="#008b8b"/>
        <circle cx="350" cy="108" r="2.5" fill="#008b8b"/>
        <circle cx="400" cy="158" r="2.5" fill="#008b8b"/>
        <circle cx="450" cy="139" r="2.5" fill="#008b8b"/>
        <text x="250" y="250" font-size="9" fill="#6b7280" text-anchor="middle">Years post treatment</text>
      </svg>
    </div>
  </div>

  <h2>Heterogeneous Treatment Effects</h2>

  <div class="code">
    <div class="code-head"><span>python</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
    <pre><code><span class="c"># Great Lakes states indicator</span>
gls = [<span class="n">17</span>,<span class="n">18</span>,<span class="n">26</span>,<span class="n">27</span>,<span class="n">36</span>,<span class="n">39</span>,<span class="n">42</span>,<span class="n">55</span>]
mpdta[<span class="s">"gls"</span>] = mpdta[<span class="s">"countyreal"</span>].<span class="f">astype</span>(<span class="n">str</span>).<span class="f">str</span>[:<span class="n">2</span>].<span class="f">astype</span>(<span class="n">int</span>).<span class="f">isin</span>(gls)

hmod = <span class="f">etwfe</span>(
    fml=<span class="s">"lemp ~ lpop"</span>, tvar=<span class="s">"year"</span>, gvar=<span class="s">"first_treat"</span>,
    data=mpdta, cgroup=<span class="s">"never"</span>, vcov={<span class="s">"CRV1"</span>: <span class="s">"countyreal"</span>},
    xvar=<span class="s">"gls"</span>
)
hmod.<span class="f">emfx</span>().<span class="f">plot</span>()</code></pre>
  </div>

  <div class="plot-container">
    <div class="plot-header">
      <div class="plot-title">Heterogeneous ATT</div>
      <div class="plot-subtitle">Great Lakes vs Other</div>
    </div>
    <div class="plot-body">
      <svg viewBox="0 0 340 200" xmlns="http://www.w3.org/2000/svg">
        <rect x="60" y="20" width="220" height="140" fill="#fff" stroke="#e5e7eb"/>
        <g stroke="#f3f4f6"><line x1="60" y1="41" x2="280" y2="41"/><line x1="60" y1="62" x2="280" y2="62"/><line x1="60" y1="104" x2="280" y2="104"/><line x1="60" y1="125" x2="280" y2="125"/><line x1="60" y1="146" x2="280" y2="146"/></g>
        <line x1="60" y1="62" x2="280" y2="62" stroke="#94a3b8" stroke-dasharray="4,3"/>
        <text x="52" y="24" font-size="9" fill="#6b7280" text-anchor="end">0.05</text>
        <text x="52" y="45" font-size="9" fill="#6b7280" text-anchor="end">0.02</text>
        <text x="52" y="66" font-size="9" fill="#6b7280" text-anchor="end">0</text>
        <text x="52" y="87" font-size="9" fill="#6b7280" text-anchor="end">−0.03</text>
        <text x="52" y="108" font-size="9" fill="#6b7280" text-anchor="end">−0.06</text>
        <text x="52" y="129" font-size="9" fill="#6b7280" text-anchor="end">−0.09</text>
        <text x="52" y="150" font-size="9" fill="#6b7280" text-anchor="end">−0.12</text>
        <text x="130" y="175" font-size="9" fill="#6b7280" text-anchor="middle">gls=False</text>
        <text x="220" y="175" font-size="9" fill="#6b7280" text-anchor="middle">gls=True</text>
        <!-- Non-GLS: -0.0519 (-0.120, 0.016) -->
        <g stroke="#2563eb" stroke-width="1.2">
          <line x1="130" y1="148" x2="130" y2="50"/><line x1="124" y1="148" x2="136" y2="148"/><line x1="124" y1="50" x2="136" y2="50"/>
        </g>
        <circle cx="130" cy="99" r="3.5" fill="#2563eb"/>
        <!-- GLS: -0.0394 (-0.087, 0.008) -->
        <g stroke="#f59e0b" stroke-width="1.2">
          <line x1="220" y1="124" x2="220" y2="56"/><line x1="214" y1="124" x2="226" y2="124"/><line x1="214" y1="56" x2="226" y2="56"/>
        </g>
        <circle cx="220" cy="90" r="3.5" fill="#f59e0b"/>
      </svg>
    </div>
    <div class="plot-footer">Confidence intervals overlap; no significant difference between groups.</div>
  </div>

  <div class="code">
    <div class="code-head"><span>python</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
    <pre><code>hmod.<span class="f">emfx</span>(type=<span class="s">"event"</span>).<span class="f">plot</span>(type=<span class="s">"ribbon"</span>)</code></pre>
  </div>

  <div class="plot-container">
    <div class="plot-header">
      <div class="plot-title">Heterogeneous Event Study</div>
      <div class="plot-subtitle">Dynamic effects by Great Lakes status</div>
    </div>
    <div class="plot-body">
      <svg viewBox="0 0 440 260" xmlns="http://www.w3.org/2000/svg">
        <rect x="50" y="20" width="360" height="200" fill="#fff" stroke="#e5e7eb"/>
        <g stroke="#f3f4f6"><line x1="50" y1="48" x2="410" y2="48"/><line x1="50" y1="77" x2="410" y2="77"/><line x1="50" y1="135" x2="410" y2="135"/><line x1="50" y1="163" x2="410" y2="163"/><line x1="50" y1="192" x2="410" y2="192"/></g>
        <line x1="50" y1="77" x2="410" y2="77" stroke="#94a3b8" stroke-dasharray="4,3"/>
        <line x1="170" y1="20" x2="170" y2="220" stroke="#94a3b8" stroke-dasharray="3,3"/>
        <text x="42" y="22" font-size="9" fill="#6b7280" text-anchor="end">0.10</text>
        <text x="42" y="51" font-size="9" fill="#6b7280" text-anchor="end">0.05</text>
        <text x="42" y="80" font-size="9" fill="#6b7280" text-anchor="end">0</text>
        <text x="42" y="109" font-size="9" fill="#6b7280" text-anchor="end">−0.05</text>
        <text x="42" y="138" font-size="9" fill="#6b7280" text-anchor="end">−0.10</text>
        <text x="42" y="167" font-size="9" fill="#6b7280" text-anchor="end">−0.15</text>
        <text x="42" y="196" font-size="9" fill="#6b7280" text-anchor="end">−0.20</text>
        <text x="110" y="235" font-size="9" fill="#6b7280" text-anchor="middle">−3</text>
        <text x="170" y="235" font-size="9" fill="#6b7280" text-anchor="middle">−2</text>
        <text x="230" y="235" font-size="9" fill="#6b7280" text-anchor="middle">−1</text>
        <text x="290" y="235" font-size="9" fill="#6b7280" text-anchor="middle">0</text>
        <text x="350" y="235" font-size="9" fill="#6b7280" text-anchor="middle">1</text>
        <text x="410" y="235" font-size="9" fill="#6b7280" text-anchor="middle">2</text>
        <!-- Non-GLS ribbon -->
        <polygon points="110,60 170,65 230,77 290,90 350,115 410,160 410,200 350,145 290,100 230,77 170,80 110,85" fill="#2563eb" opacity="0.12"/>
        <!-- GLS ribbon -->
        <polygon points="110,55 170,60 230,77 290,85 350,108 410,150 410,190 350,138 290,95 230,77 170,75 110,80" fill="#f59e0b" opacity="0.12"/>
        <!-- Non-GLS line -->
        <polyline points="110,72 170,72 230,77 290,95 350,130 410,180" fill="none" stroke="#2563eb" stroke-width="1.5"/>
        <!-- GLS line -->
        <polyline points="110,68 170,68 230,77 290,90 350,123 410,170" fill="none" stroke="#f59e0b" stroke-width="1.5"/>
        <!-- Points -->
        <circle cx="110" cy="72" r="2.5" fill="#2563eb"/>
        <circle cx="170" cy="72" r="2.5" fill="#2563eb"/>
        <circle cx="230" cy="77" r="2" fill="#6b7280"/>
        <circle cx="290" cy="95" r="2.5" fill="#2563eb"/>
        <circle cx="350" cy="130" r="2.5" fill="#2563eb"/>
        <circle cx="410" cy="180" r="2.5" fill="#2563eb"/>
        <circle cx="114" cy="68" r="2.5" fill="#f59e0b"/>
        <circle cx="174" cy="68" r="2.5" fill="#f59e0b"/>
        <circle cx="294" cy="90" r="2.5" fill="#f59e0b"/>
        <circle cx="354" cy="123" r="2.5" fill="#f59e0b"/>
        <circle cx="414" cy="170" r="2.5" fill="#f59e0b"/>
        <!-- Legend -->
        <rect x="330" y="30" width="75" height="36" fill="#fff" stroke="#e5e7eb" rx="3"/>
        <line x1="338" y1="42" x2="352" y2="42" stroke="#2563eb" stroke-width="1.5"/>
        <circle cx="345" cy="42" r="2" fill="#2563eb"/>
        <text x="358" y="45" font-size="8" fill="#374151">gls=False</text>
        <line x1="338" y1="56" x2="352" y2="56" stroke="#f59e0b" stroke-width="1.5"/>
        <circle cx="345" cy="56" r="2" fill="#f59e0b"/>
        <text x="358" y="59" font-size="8" fill="#374151">gls=True</text>
        <text x="230" y="250" font-size="9" fill="#6b7280" text-anchor="middle">Event time</text>
      </svg>
    </div>
    <div class="plot-footer">Both groups track similarly; non-GLS shows slightly larger effects in later periods.</div>
  </div>

  <h2>Other Aggregations</h2>

  <div class="cols-2">
    <div class="out">
      <div class="out-label">By Treatment Cohort</div>
      <table>
        <tr><th>first_treat</th><th class="r">estimate</th><th class="r">std.error</th></tr>
        <tr><td>2004</td><td class="r">-0.0876</td><td class="r">0.0253</td></tr>
        <tr><td>2006</td><td class="r">-0.0213</td><td class="r">0.0185</td></tr>
        <tr><td>2007</td><td class="r">-0.0460</td><td class="r">0.0168</td></tr>
      </table>
    </div>
    <div class="out">
      <div class="out-label">By Calendar Year</div>
      <table>
        <tr><th>year</th><th class="r">estimate</th><th class="r">std.error</th></tr>
        <tr><td>2004</td><td class="r">-0.0212</td><td class="r">0.0218</td></tr>
        <tr><td>2005</td><td class="r">-0.0819</td><td class="r">0.0277</td></tr>
        <tr><td>2006</td><td class="r">-0.0443</td><td class="r">0.0173</td></tr>
        <tr><td>2007</td><td class="r">-0.0524</td><td class="r">0.0168</td></tr>
      </table>
    </div>
  </div>

  <h2>Function Reference</h2>
  
  <div class="code">
    <div class="code-head"><span>etwfe()</span></div>
    <pre><code><span class="f">etwfe</span>(fml, tvar, gvar, data, ivar=<span class="k">None</span>, xvar=<span class="k">None</span>,
      cgroup=<span class="s">"notyet"</span>, fe=<span class="s">"vs"</span>, family=<span class="k">None</span>, vcov=<span class="k">None</span>)</code></pre>
  </div>

  <div class="code">
    <div class="code-head"><span>emfx()</span></div>
    <pre><code>model.<span class="f">emfx</span>(type=<span class="s">"simple"</span>, by_xvar=<span class="k">False</span>, post_only=<span class="k">True</span>,
           vcov=<span class="k">True</span>, compress=<span class="k">False</span>, predict=<span class="s">"response"</span>)</code></pre>
  </div>

  <h2>References</h2>
  <p class="ref">
    Wooldridge, J. M. (2021). <em>Two-Way Fixed Effects, the Two-Way Mundlak Regression, and DiD Estimators.</em><br>
    Wooldridge, J. M. (2023). <em>Simple Approaches to Nonlinear DiD with Panel Data.</em> The Econometrics Journal.<br><br>
    R implementation: <a href="https://grantmcdermott.com/etwfe/">grantmcdermott.com/etwfe</a>
  </p>

  <footer>
    <a href="index.html">Armand Kapllani</a>
    <a href="https://pypi.org/project/etwfe/">PyPI</a>
    <a href="https://github.com/armandkapllani/etwfe">GitHub</a>
  </footer>

  <script>
    function copyCode(btn) {
      const code = btn.closest('.code').querySelector('code').innerText;
      navigator.clipboard.writeText(code);
      btn.textContent = '✓';
      setTimeout(() => btn.textContent = 'Copy', 2000);
    }
  </script>

</body>
</html>
