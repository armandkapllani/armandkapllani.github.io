<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>etwfe — Extended Two-Way Fixed Effects</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #fafafa;
      --card: #ffffff;
      --text: #171717;
      --muted: #525252;
      --border: #e5e5e5;
      --accent: #2563eb;
      --accent-light: #eff6ff;
      --code-bg: #18181b;
      --code-text: #fafafa;
      --green: #22c55e;
      --purple: #8b5cf6;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'Inter', -apple-system, sans-serif;
      font-size: 15px;
      line-height: 1.7;
      color: var(--text);
      background: var(--bg);
    }

    .container {
      max-width: 800px;
      margin: 0 auto;
      padding: 0 24px;
    }

    a { color: var(--accent); text-decoration: none; }
    a:hover { text-decoration: underline; }

    /* Hero */
    .hero {
      background: linear-gradient(135deg, #1e3a8a 0%, #7c3aed 100%);
      padding: 64px 24px;
      margin-bottom: 48px;
    }

    .hero-inner {
      max-width: 800px;
      margin: 0 auto;
    }

    .logo {
      font-family: 'Fira Code', monospace;
      font-size: 3rem;
      font-weight: 700;
      color: #fff;
      margin-bottom: 8px;
    }

    .tagline {
      font-size: 1.2rem;
      color: rgba(255,255,255,0.8);
      margin-bottom: 32px;
    }

    .hero-links {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      align-items: center;
    }

    .btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 12px 20px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 500;
      transition: all 0.2s;
    }

    .btn-primary {
      background: #fff;
      color: #1e3a8a;
    }

    .btn-primary:hover { background: #f0f0f0; text-decoration: none; }

    .btn-secondary {
      background: rgba(255,255,255,0.15);
      color: #fff;
      border: 1px solid rgba(255,255,255,0.25);
    }

    .btn-secondary:hover { background: rgba(255,255,255,0.25); text-decoration: none; }

    .btn svg { width: 18px; height: 18px; }

    .install-box {
      display: inline-block;
      background: rgba(0,0,0,0.3);
      padding: 12px 20px;
      border-radius: 8px;
      font-family: 'Fira Code', monospace;
      font-size: 14px;
      color: #fff;
    }

    .install-box span { color: var(--green); }

    /* Cards */
    .card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 32px;
      margin-bottom: 24px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.04);
    }

    h2 {
      font-size: 1.4rem;
      font-weight: 600;
      color: var(--text);
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    h2 .icon {
      width: 28px;
      height: 28px;
      background: var(--accent-light);
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    h2 .icon svg { width: 16px; height: 16px; color: var(--accent); }

    h3 {
      font-size: 1rem;
      font-weight: 600;
      color: var(--text);
      margin: 28px 0 12px;
    }

    p { margin-bottom: 14px; }

    p code, li code {
      font-family: 'Fira Code', monospace;
      font-size: 0.85em;
      background: #f4f4f5;
      padding: 2px 6px;
      border-radius: 4px;
      color: #dc2626;
    }

    ul, ol { margin-bottom: 14px; padding-left: 24px; }
    li { margin-bottom: 6px; }

    /* Code */
    .code {
      background: var(--code-bg);
      border-radius: 10px;
      margin: 20px 0;
      overflow: hidden;
    }

    .code-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 16px;
      background: #27272a;
      border-bottom: 1px solid #3f3f46;
    }

    .code-label {
      font-family: 'Fira Code', monospace;
      font-size: 12px;
      color: #a1a1aa;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .code-label::before {
      content: '';
      width: 8px;
      height: 8px;
      background: var(--green);
      border-radius: 50%;
    }

    .copy-btn {
      background: #3f3f46;
      border: none;
      color: #a1a1aa;
      padding: 5px 12px;
      border-radius: 5px;
      font-size: 12px;
      cursor: pointer;
      font-family: 'Inter', sans-serif;
    }

    .copy-btn:hover { background: #52525b; color: #fff; }

    pre {
      margin: 0;
      padding: 20px;
      overflow-x: auto;
    }

    pre code {
      font-family: 'Fira Code', monospace;
      font-size: 13px;
      line-height: 1.7;
      color: var(--code-text);
      background: none;
      padding: 0;
    }

    .kw { color: #f472b6; }
    .fn { color: #818cf8; }
    .str { color: #4ade80; }
    .num { color: #fbbf24; }
    .cmt { color: #71717a; }

    /* Output */
    .output {
      background: #fafafa;
      border: 1px solid var(--border);
      border-radius: 10px;
      margin: 20px 0;
      overflow: hidden;
    }

    .output-header {
      padding: 10px 16px;
      font-size: 12px;
      font-weight: 600;
      color: var(--muted);
      background: #f4f4f5;
      border-bottom: 1px solid var(--border);
    }

    .output pre {
      font-family: 'Fira Code', monospace;
      font-size: 12px;
      line-height: 1.5;
      color: var(--text);
      padding: 16px;
      background: none;
    }

    /* Tables */
    .table-wrap {
      overflow-x: auto;
      margin: 20px 0;
      border: 1px solid var(--border);
      border-radius: 10px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 14px;
    }

    th, td {
      text-align: left;
      padding: 12px 16px;
      border-bottom: 1px solid var(--border);
    }

    th {
      font-weight: 600;
      background: #fafafa;
      color: var(--muted);
      font-size: 12px;
    }

    tr:last-child td { border-bottom: none; }
    tr:hover td { background: #fafafa; }

    .param { color: var(--accent); font-weight: 500; }

    /* Refs */
    .refs {
      font-size: 14px;
      color: var(--muted);
      line-height: 2;
    }

    .refs em { color: var(--text); }

    /* Footer */
    footer {
      background: var(--code-bg);
      color: #a1a1aa;
      padding: 48px 24px;
      margin-top: 48px;
    }

    .footer-inner {
      max-width: 800px;
      margin: 0 auto;
      text-align: center;
    }

    .footer-links {
      display: flex;
      justify-content: center;
      gap: 24px;
      margin-bottom: 24px;
    }

    .footer-links a {
      color: #a1a1aa;
      font-size: 14px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .footer-links a:hover { color: #fff; text-decoration: none; }
    .footer-links svg { width: 18px; height: 18px; }

    .footer-dev {
      padding-top: 24px;
      border-top: 1px solid #3f3f46;
      font-size: 14px;
    }

    .footer-dev a { color: #fff; font-weight: 500; }

    .footer-made {
      margin-top: 8px;
      font-size: 13px;
      color: #71717a;
    }
  </style>
</head>
<body>

<div class="hero">
  <div class="hero-inner">
    <div class="logo">etwfe</div>
    <p class="tagline">Extended Two-Way Fixed Effects • etwfe</p>
    <div class="hero-links">
      <div class="install-box"><span>$</span> pip install etwfe</div>
      <a href="https://pypi.org/project/etwfe/" class="btn btn-secondary">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/></svg>
        PyPI
      </a>
      <a href="https://github.com/armandkapllani/etwfe" class="btn btn-secondary">
        <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg>
        GitHub
      </a>
      <a href="https://github.com/grantmcdermott/etwfe" class="btn btn-secondary">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg>
        R Package
      </a>
    </div>
  </div>
</div>

<div class="container">

  <div class="card">
    <h2>
      <span class="icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4M12 8h.01"/></svg></span>
      Background
    </h2>
    <p>
      The <strong>etwfe</strong> package brings Wooldridge's Extended Two-Way Fixed Effects methodology to Python. It is a Python implementation following the design of the <a href="https://github.com/grantmcdermott/etwfe">etwfe R package</a> created by <a href="https://grantmcdermott.com/">Grant McDermott</a>. R users may prefer the <a href="https://github.com/grantmcdermott/etwfe">original R package</a>.
    </p>
    <p>
      Researchers commonly use two-way fixed effects (TWFE) regressions—models that include both unit and time fixed effects—when analyzing panel data to estimate causal effects. This technique removes time-invariant unit characteristics and common temporal shocks, leaving variation that can plausibly identify treatment effects when the standard difference-in-differences assumptions hold.
    </p>
    <p>
      Methodologists recently uncovered problems with applying naive TWFE specifications to settings where treatment adoption is staggered across units. The culprit is not the fixed effects themselves but rather the overly restrictive assumption that treatment effects are constant across all cohorts and time periods. When effects actually differ—for example, growing over time or varying by when units adopted treatment—the standard approach conflates these heterogeneous effects in ways that can produce misleading estimates.
    </p>
    <p>
      Wooldridge (2023, 2025) proposed a clean solution: include all interactions between treatment status, cohort membership, and time periods. This saturated specification—termed extended TWFE (ETWFE)—recovers cohort-time-specific treatment effects that researchers can then combine into summary measures: overall average effects, dynamic event-study patterns, or comparisons across treatment cohorts.
    </p>
    <p>
      A notable theoretical finding is that several different estimation approaches—imputation methods, pooled OLS with appropriate dummies, random effects, and TWFE itself—all yield identical point estimates when applied to this flexible model. Furthermore, these estimates match those from the regression-based estimators in Callaway and Sant'Anna (2021), linking ETWFE directly to other modern difference-in-differences methods.
    </p>
    <p>
      The methodology also accommodates nonlinear outcomes. When dealing with binary responses, count data, or fractional outcomes, assuming parallel trends in levels may be unrealistic. Wooldridge (2023) demonstrates that pooled quasi-maximum likelihood estimation using appropriate link functions identifies treatment effects under an index version of parallel trends—maintaining the same equivalence properties as the linear case.
    </p>
    <p>
      This Python package handles the tedious work of building the saturated interaction specification, performs estimation through high-dimensional fixed effects or quasi-MLE, and extracts interpretable treatment effect estimates with proper standard errors.
    </p>
  </div>

  <div class="card">
    <h2>
      <span class="icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg></span>
      Sample Data
    </h2>
    <p>
      The examples in this guide use <code>mpdta</code>, a panel dataset tracking teen employment in 500 U.S. counties from 2003 through 2007. Some counties implemented minimum wage increases in 2004, 2006, or 2007, while others never raised their minimum wage—creating a textbook staggered adoption design for difference-in-differences analysis.
    </p>

    <div class="code">
      <div class="code-header">
        <span class="code-label">python</span>
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
      </div>
      <pre><code><span class="kw">from</span> etwfe <span class="kw">import</span> etwfe
<span class="kw">import</span> pyreadr

<span class="cmt"># Retrieve the dataset</span>
url = <span class="str">"https://github.com/bcallaway11/did/raw/master/data/mpdta.rda"</span>
pyreadr.<span class="fn">download_file</span>(url, <span class="str">"mpdta.rda"</span>)
mpdta = pyreadr.<span class="fn">read_r</span>(<span class="str">"mpdta.rda"</span>)[<span class="str">"mpdta"</span>]

<span class="cmt"># Set up the variables</span>
mpdta[<span class="str">"first_treat"</span>] = mpdta[<span class="str">"first.treat"</span>].<span class="fn">astype</span>(<span class="num">int</span>)
mpdta[<span class="str">"year"</span>] = mpdta[<span class="str">"year"</span>].<span class="fn">astype</span>(<span class="num">int</span>)
mpdta[<span class="str">"countyreal"</span>] = mpdta[<span class="str">"countyreal"</span>].<span class="fn">astype</span>(<span class="num">int</span>)

mpdta.<span class="fn">head</span>()</code></pre>
    </div>

    <div class="output">
      <div class="output-header">Output</div>
      <pre>    year  countyreal      lpop      lemp  first.treat  treat  first_treat
866 2003        8001  5.896761  8.461469         2007      1         2007
841 2004        8001  5.896761  8.336870         2007      1         2007
842 2005        8001  5.896761  8.340217         2007      1         2007
819 2006        8001  5.896761  8.378161         2007      1         2007
827 2007        8001  5.896761  8.487352         2007      1         2007</pre>
    </div>

    <p>
      The outcome of interest is <code>lemp</code>, which records log teen employment. The <code>first_treat</code> column indicates the year a county first saw a minimum wage increase (with 0 denoting counties that never experienced an increase). We also have <code>lpop</code> (log population) available as a potential covariate.
    </p>
  </div>

  <div class="card">
    <h2>
      <span class="icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="16 18 22 12 16 6"/><polyline points="8 6 2 12 8 18"/></svg></span>
      Core Workflow
    </h2>
    <p>
      Analysis with <strong>etwfe</strong> proceeds in two stages. First, <code>etwfe()</code> fits the saturated interaction specification. Second, <code>emfx()</code> transforms the many coefficient estimates into meaningful treatment effect summaries.
    </p>

    <h3>Fitting the Model</h3>
    <p>
      The <code>etwfe()</code> function requires a formula identifying the outcome and any covariates, plus arguments specifying the time period variable, treatment cohort variable, and the data. Clustering standard errors by unit is generally advisable for panel data.
    </p>

    <div class="code">
      <div class="code-header">
        <span class="code-label">python</span>
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
      </div>
      <pre><code>mod = <span class="fn">etwfe</span>(
    fml=<span class="str">"lemp ~ lpop"</span>,          <span class="cmt"># outcome ~ covariates</span>
    tvar=<span class="str">"year"</span>,                <span class="cmt"># time period</span>
    gvar=<span class="str">"first_treat"</span>,         <span class="cmt"># treatment cohort</span>
    data=mpdta,
    vcov={<span class="str">"CRV1"</span>: <span class="str">"countyreal"</span>}  <span class="cmt"># cluster by county</span>
)</code></pre>
    </div>

    <p>
      Behind the scenes, the function constructs treatment indicators and fully interacts them with cohort and time dummies. The fitted object wraps a pyfixest regression, so methods like <code>.summary()</code> work as expected. However, the raw interaction coefficients lack direct interpretation—that's where <code>emfx()</code> becomes essential.
    </p>

    <h3>Extracting Treatment Effects</h3>
    <p>
      The <code>emfx()</code> method aggregates the interaction coefficients into interpretable treatment effect estimates. A basic call produces the overall average treatment effect on the treated:
    </p>

    <div class="code">
      <div class="code-header">
        <span class="code-label">python</span>
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
      </div>
      <pre><code><span class="cmt"># Overall average effect</span>
mod.<span class="fn">emfx</span>()</code></pre>
    </div>

    <div class="output">
      <div class="output-header">Average Treatment Effect</div>
      <pre>   _Dtreat  estimate  std.error  conf.low  conf.high
0      1.0 -0.050627   0.012497 -0.075122  -0.026132</pre>
    </div>

    <p>
      The estimate of −0.051 implies that minimum wage increases lowered teen employment by roughly 5% on average across treated counties and post-treatment periods. The confidence interval excludes zero, indicating statistical significance.
    </p>
    <p>
      The <code>type</code> parameter controls how effects are broken down. Setting <code>type="event"</code> generates an event study that tracks effects relative to treatment timing:
    </p>

    <div class="code">
      <div class="code-header">
        <span class="code-label">python</span>
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
      </div>
      <pre><code><span class="cmt"># Dynamic event study</span>
mod.<span class="fn">emfx</span>(type=<span class="str">"event"</span>)</code></pre>
    </div>

    <div class="output">
      <div class="output-header">Event Study</div>
      <pre>   event  estimate  std.error  conf.low  conf.high
0      0 -0.033212   0.013366 -0.059409  -0.007015
1      1 -0.057346   0.017150 -0.090959  -0.023732
2      2 -0.137870   0.030788 -0.198216  -0.077525
3      3 -0.109539   0.032315 -0.172877  -0.046202</pre>
    </div>

    <p>
      The event study uncovers interesting dynamics: effects begin modestly (−3.3% at the treatment date) but amplify substantially over subsequent years, peaking at −13.8% two years after adoption before moderating slightly.
    </p>
  </div>

  <div class="card">
    <h2>
      <span class="icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/></svg></span>
      Creating Visualizations
    </h2>

    <h3>Event Study Plots</h3>
    <p>
      The <code>plot()</code> method generates ready-to-use visualizations. The default style shows point estimates with error bars:
    </p>

    <div class="code">
      <div class="code-header">
        <span class="code-label">python</span>
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
      </div>
      <pre><code>mod.<span class="fn">plot</span>(type=<span class="str">"event"</span>)</code></pre>
    </div>

    <p>
      When using the default <code>cgroup="notyet"</code> control group, pre-treatment coefficients are mechanically zero because not-yet-treated observations serve as controls during those periods. To assess whether parallel trends held before treatment—a crucial diagnostic—restrict the comparison group to never-treated units:
    </p>

    <div class="code">
      <div class="code-header">
        <span class="code-label">python</span>
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
      </div>
      <pre><code>mod_never = <span class="fn">etwfe</span>(
    fml=<span class="str">"lemp ~ lpop"</span>,
    tvar=<span class="str">"year"</span>,
    gvar=<span class="str">"first_treat"</span>,
    data=mpdta,
    cgroup=<span class="str">"never"</span>,              <span class="cmt"># only never-treated as controls</span>
    vcov={<span class="str">"CRV1"</span>: <span class="str">"countyreal"</span>}
)

<span class="cmt"># Include pre-treatment periods</span>
mod_never.<span class="fn">emfx</span>(type=<span class="str">"event"</span>, post_only=<span class="kw">False</span>)</code></pre>
    </div>

    <div class="output">
      <div class="output-header">Event Study with Pre-Treatment</div>
      <pre>   event  estimate  std.error  conf.low  conf.high
0     -4  0.006896   0.024689 -0.041495   0.055287
1     -3  0.027595   0.018148 -0.007976   0.063166
2     -2  0.023465   0.014531 -0.005017   0.051947
3     -1  0.000000   0.000000  0.000000   0.000000
4      0 -0.021147   0.011394 -0.043478   0.001185
5      1 -0.053356   0.015774 -0.084274  -0.022438
6      2 -0.141080   0.032289 -0.204367  -0.077793
7      3 -0.107544   0.032923 -0.172074  -0.043015</pre>
    </div>

    <p>
      The pre-treatment estimates (events −4 through −2) cluster near zero with confidence intervals spanning it, supporting the parallel trends assumption. For a smoother visual, use ribbon-style confidence bands:
    </p>

    <div class="code">
      <div class="code-header">
        <span class="code-label">python</span>
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
      </div>
      <pre><code>mod_never.<span class="fn">plot</span>(type=<span class="str">"event"</span>, post_only=<span class="kw">False</span>, style=<span class="str">"ribbon"</span>)</code></pre>
    </div>

    <h3>Comparing Specifications</h3>
    <p>
      Presenting multiple specifications together strengthens an analysis. Here's how to build a comparison table:
    </p>

    <div class="code">
      <div class="code-header">
        <span class="code-label">python</span>
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
      </div>
      <pre><code><span class="kw">import</span> pandas <span class="kw">as</span> pd

<span class="cmt"># Gather results from both specifications</span>
es_never = mod_never.<span class="fn">emfx</span>(type=<span class="str">"event"</span>, post_only=<span class="kw">False</span>)[[<span class="str">"event"</span>, <span class="str">"estimate"</span>, <span class="str">"std.error"</span>]]
es_notyet = mod.<span class="fn">emfx</span>(type=<span class="str">"event"</span>)[[<span class="str">"event"</span>, <span class="str">"estimate"</span>, <span class="str">"std.error"</span>]]

<span class="cmt"># Label columns</span>
es_never.columns = [<span class="str">"event"</span>, <span class="str">"est_1"</span>, <span class="str">"se_1"</span>]
es_notyet.columns = [<span class="str">"event"</span>, <span class="str">"est_2"</span>, <span class="str">"se_2"</span>]

<span class="cmt"># Combine</span>
comparison = es_never.<span class="fn">merge</span>(es_notyet, on=<span class="str">"event"</span>, how=<span class="str">"outer"</span>)
comparison = comparison.<span class="fn">sort_values</span>(<span class="str">"event"</span>).<span class="fn">reset_index</span>(drop=<span class="kw">True</span>)</code></pre>
    </div>

    <div class="output">
      <div class="output-header">Specification Comparison</div>
      <pre>
==================================================
                    Event Study
==================================================
                                  (1)        (2)
--------------------------------------------------
Years post treatment = -4       0.007
                               (0.025)
Years post treatment = -3       0.028
                               (0.018)
Years post treatment = -2       0.023
                               (0.015)
Years post treatment = -1       0.000

Years post treatment = 0      -0.021+    -0.033*
                               (0.011)    (0.013)
Years post treatment = 1      -0.053***  -0.057***
                               (0.016)    (0.017)
Years post treatment = 2      -0.141***  -0.138***
                               (0.032)    (0.031)
Years post treatment = 3      -0.108**   -0.110***
                               (0.033)    (0.032)
--------------------------------------------------
+ p < 0.1, * p < 0.05, ** p < 0.01, *** p < 0.001</pre>
    </div>
  </div>

  <div class="card">
    <h2>
      <span class="icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="8.5" cy="7" r="4"/><line x1="20" y1="8" x2="20" y2="14"/><line x1="23" y1="11" x2="17" y2="11"/></svg></span>
      Effect Heterogeneity
    </h2>
    <p>
      Treatment effects frequently differ across subpopulations. The <code>xvar</code> parameter enables estimation of heterogeneous effects by interacting treatment with a categorical moderator.
    </p>
    <p>
      As an illustration, we can test whether minimum wage impacts differ between Great Lakes states and other regions:
    </p>

    <div class="code">
      <div class="code-header">
        <span class="code-label">python</span>
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
      </div>
      <pre><code><span class="cmt"># Flag Great Lakes states by FIPS code</span>
great_lakes = [<span class="num">17</span>, <span class="num">18</span>, <span class="num">26</span>, <span class="num">27</span>, <span class="num">36</span>, <span class="num">39</span>, <span class="num">42</span>, <span class="num">55</span>]
mpdta[<span class="str">"gls"</span>] = mpdta[<span class="str">"countyreal"</span>].<span class="fn">astype</span>(<span class="num">str</span>).<span class="fn">str</span>[:<span class="num">2</span>].<span class="fn">astype</span>(<span class="num">int</span>).<span class="fn">isin</span>(great_lakes)</code></pre>
    </div>

    <p>
      With <code>xvar</code> specified, <code>emfx(by_xvar=True)</code> produces separate estimates for each subgroup:
    </p>

    <div class="code">
      <div class="code-header">
        <span class="code-label">python</span>
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
      </div>
      <pre><code>hmod = <span class="fn">etwfe</span>(
    fml=<span class="str">"lemp ~ lpop"</span>,
    tvar=<span class="str">"year"</span>,
    gvar=<span class="str">"first_treat"</span>,
    data=mpdta,
    cgroup=<span class="str">"never"</span>,
    xvar=<span class="str">"gls"</span>,                  <span class="cmt"># heterogeneity dimension</span>
    vcov={<span class="str">"CRV1"</span>: <span class="str">"countyreal"</span>}
)

<span class="cmt"># Subgroup-specific effects</span>
hmod.<span class="fn">emfx</span>(by_xvar=<span class="kw">True</span>)</code></pre>
    </div>

    <div class="output">
      <div class="output-header">Effects by Region</div>
      <pre>   estimate  std.error  conf.low  conf.high  _Dtreat    gls
0 -0.051920   0.034637 -0.119809   0.015969      1.0  False
1 -0.039396   0.024296 -0.087016   0.008223      1.0   True</pre>
    </div>

    <p>
      Both regions exhibit negative point estimates, though the confidence intervals overlap considerably—the regional difference doesn't appear statistically meaningful. Visualize the heterogeneous event study with:
    </p>

    <div class="code">
      <div class="code-header">
        <span class="code-label">python</span>
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
      </div>
      <pre><code>hmod.<span class="fn">plot</span>(type=<span class="str">"event"</span>, by_xvar=<span class="kw">True</span>, style=<span class="str">"ribbon"</span>)</code></pre>
    </div>
  </div>

  <div class="card">
    <h2>
      <span class="icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg></span>
      Nonlinear Specifications
    </h2>
    <p>
      Standard ETWFE presumes that treated and control groups follow parallel trajectories in outcome levels. This "linear parallel trends" assumption becomes questionable when outcomes have bounded ranges or skewed distributions.
    </p>

    <h3>When Linear Assumptions Strain</h3>
    <p>
      Consider binary outcomes where baseline rates differ markedly between groups—say 15% versus 40%. Expecting parallel evolution in probability levels may be implausible; perhaps trends should be parallel in log-odds instead. Analogous concerns arise with count data clustering near zero, or fractional responses constrained between 0 and 1.
    </p>
    <p>
      Wooldridge (2023) developed nonlinear ETWFE estimators that assume parallel trends in an index (the linear predictor) rather than the outcome itself. For binary outcomes, this suggests logit; for counts, Poisson. These estimators preserve the same equivalence results as linear ETWFE—pooled quasi-MLE and imputation yield identical estimates.
    </p>

    <h3>Poisson Implementation</h3>
    <p>
      Here we apply Poisson regression to employment counts rather than log employment:
    </p>

    <div class="code">
      <div class="code-header">
        <span class="code-label">python</span>
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
      </div>
      <pre><code><span class="kw">import</span> numpy <span class="kw">as</span> np

<span class="cmt"># Convert to levels</span>
mpdta[<span class="str">"emp"</span>] = np.<span class="fn">exp</span>(mpdta[<span class="str">"lemp"</span>])

<span class="cmt"># Poisson ETWFE</span>
mod_pois = <span class="fn">etwfe</span>(
    fml=<span class="str">"emp ~ lpop"</span>,
    tvar=<span class="str">"year"</span>,
    gvar=<span class="str">"first_treat"</span>,
    data=mpdta,
    vcov={<span class="str">"CRV1"</span>: <span class="str">"countyreal"</span>},
    family=<span class="str">"poisson"</span>
)

mod_pois.<span class="fn">emfx</span>(type=<span class="str">"event"</span>)</code></pre>
    </div>

    <div class="output">
      <div class="output-header">Poisson Event Study</div>
      <pre>   event   estimate  std.error    conf.low   conf.high
0      0 -25.349748  15.886320  -56.486936    5.787439
1      1   1.091751  40.295264  -77.886967   80.070469
2      2 -75.124632  23.154168 -120.506802  -29.742462
3      3 -101.823979  27.087814 -154.916095  -48.731864</pre>
    </div>

    <h3>Robustness Assessment</h3>
    <p>
      Even when linear parallel trends seems reasonable, running both linear and nonlinear models provides a valuable robustness check. When estimates align across specifications, confidence in the findings grows. When they diverge, it signals sensitivity to the functional form assumption—useful diagnostic information for interpreting results.
    </p>
  </div>

  <div class="card">
    <h2>
      <span class="icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg></span>
      Computational Efficiency
    </h2>
    <p>
      Model fitting via <code>etwfe()</code> runs quickly. The <code>emfx()</code> marginal effects calculation can slow down with large datasets due to the high dimensionality of interaction terms. Two strategies help manage computation time.
    </p>

    <h3>Omitting Standard Errors</h3>
    <p>
      Setting <code>vcov=False</code> skips variance-covariance estimation, which often dominates runtime. This returns point estimates only—useful for checking specifications before investing in full computation:
    </p>

    <div class="code">
      <div class="code-header">
        <span class="code-label">python</span>
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
      </div>
      <pre><code><span class="cmt"># Point estimates without standard errors</span>
mod.<span class="fn">emfx</span>(type=<span class="str">"event"</span>, vcov=<span class="kw">False</span>)</code></pre>
    </div>

    <h3>Data Compression</h3>
    <p>
      The <code>compress=True</code> option implements the data compression approach from Wong et al. (2021). The core insight is that for linear models, data can be reduced to sufficient statistics—aggregated summaries preserving all information needed for estimation.
    </p>
    <p>
      Compression can shrink datasets with millions of observations to much smaller structures, enabling interactive analysis that would otherwise demand specialized infrastructure. Point estimates match uncompressed results exactly, while standard errors are approximate but typically accurate to 2-3 decimal places.
    </p>

    <div class="code">
      <div class="code-header">
        <span class="code-label">python</span>
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
      </div>
      <pre><code><span class="cmt"># Compressed estimation</span>
mod.<span class="fn">emfx</span>(type=<span class="str">"event"</span>, compress=<span class="kw">True</span>)</code></pre>
    </div>

    <h3>Practical Approach</h3>
    <p>
      For large datasets, a staged approach works well:
    </p>
    <ol>
      <li>Run <code>emfx(vcov=False)</code> to verify point estimates look sensible</li>
      <li>Run <code>emfx(vcov=False, compress=True)</code> to confirm compression preserves estimates</li>
      <li>If results align, run <code>emfx(compress=True)</code> for approximate standard errors</li>
    </ol>

    <div class="output">
      <div class="output-header">Original vs Compressed</div>
      <pre>
                                  Original  Compressed
--------------------------------------------------
Years post treatment = 0           -0.033      -0.033
                                  (0.013)     (0.013)
Years post treatment = 1           -0.057      -0.057
                                  (0.017)     (0.017)
Years post treatment = 2           -0.138      -0.138
                                  (0.031)     (0.031)
Years post treatment = 3           -0.110      -0.110
                                  (0.032)     (0.032)</pre>
    </div>
  </div>

  <div class="card">
    <h2>
      <span class="icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/></svg></span>
      Function Reference
    </h2>

    <h3>etwfe()</h3>
    <p>Fit an Extended Two-Way Fixed Effects model.</p>

    <div class="table-wrap">
      <table>
        <tr><th>Argument</th><th>Type</th><th>Description</th></tr>
        <tr><td class="param">fml</td><td><code>str</code></td><td>Model formula: <code>"outcome ~ covariates"</code> or <code>"outcome ~ 0"</code> for no covariates</td></tr>
        <tr><td class="param">tvar</td><td><code>str</code></td><td>Name of the time period variable</td></tr>
        <tr><td class="param">gvar</td><td><code>str</code></td><td>Name of the treatment cohort variable (period of first treatment; 0 = never treated)</td></tr>
        <tr><td class="param">data</td><td><code>DataFrame</code></td><td>Panel dataset containing all required variables</td></tr>
        <tr><td class="param">ivar</td><td><code>str</code></td><td>Unit identifier for unit-level fixed effects (optional; defaults to cohort-level FE)</td></tr>
        <tr><td class="param">xvar</td><td><code>str</code></td><td>Variable for heterogeneous treatment effects (optional)</td></tr>
        <tr><td class="param">tref</td><td><code>int</code></td><td>Reference time period (optional; defaults to earliest period)</td></tr>
        <tr><td class="param">gref</td><td><code>int</code></td><td>Reference cohort (optional; defaults to 0 / never-treated)</td></tr>
        <tr><td class="param">cgroup</td><td><code>str</code></td><td>Control group specification: <code>"notyet"</code> (default) or <code>"never"</code></td></tr>
        <tr><td class="param">fe</td><td><code>str</code></td><td>Fixed effects setup: <code>"vs"</code>, <code>"feo"</code> (default), or <code>"none"</code></td></tr>
        <tr><td class="param">family</td><td><code>str</code></td><td>GLM family for nonlinear models: <code>"poisson"</code>, <code>"logit"</code>, <code>"probit"</code>, etc.</td></tr>
        <tr><td class="param">vcov</td><td><code>str | dict</code></td><td>Variance estimator, e.g., <code>{"CRV1": "cluster_var"}</code> or <code>"hetero"</code></td></tr>
      </table>
    </div>

    <h3>model.emfx()</h3>
    <p>Calculate aggregated marginal effects (treatment effect estimates).</p>

    <div class="table-wrap">
      <table>
        <tr><th>Argument</th><th>Type</th><th>Description</th></tr>
        <tr><td class="param">type</td><td><code>str</code></td><td>Aggregation method: <code>"simple"</code> (overall ATT), <code>"event"</code>, <code>"group"</code>, or <code>"calendar"</code></td></tr>
        <tr><td class="param">by_xvar</td><td><code>bool</code></td><td>Report separate effects by xvar levels (default False)</td></tr>
        <tr><td class="param">post_only</td><td><code>bool</code></td><td>Restrict to post-treatment periods only (default True)</td></tr>
        <tr><td class="param">compress</td><td><code>bool</code></td><td>Apply data compression for faster computation (default False)</td></tr>
        <tr><td class="param">vcov</td><td><code>bool</code></td><td>Calculate standard errors; set False to skip (default True)</td></tr>
        <tr><td class="param">predict</td><td><code>str</code></td><td>Prediction scale: <code>"response"</code> (default) or <code>"link"</code></td></tr>
      </table>
    </div>

    <h3>model.plot()</h3>
    <p>Generate visualizations of treatment effects.</p>

    <div class="table-wrap">
      <table>
        <tr><th>Argument</th><th>Type</th><th>Description</th></tr>
        <tr><td class="param">type</td><td><code>str</code></td><td>Plot type: <code>"event"</code>, <code>"group"</code>, or <code>"calendar"</code></td></tr>
        <tr><td class="param">style</td><td><code>str</code></td><td>Visual style: <code>"errorbar"</code> (default) or <code>"ribbon"</code></td></tr>
        <tr><td class="param">post_only</td><td><code>bool</code></td><td>Display only post-treatment periods</td></tr>
        <tr><td class="param">by_xvar</td><td><code>bool</code></td><td>Draw separate series for each xvar group</td></tr>
        <tr><td class="param">figsize</td><td><code>tuple</code></td><td>Figure dimensions as (width, height)</td></tr>
        <tr><td class="param">color</td><td><code>str</code></td><td>Color for single-group plots</td></tr>
        <tr><td class="param">colors</td><td><code>list</code></td><td>Color sequence for multi-group plots</td></tr>
      </table>
    </div>
  </div>

  <div class="card">
    <h2>
      <span class="icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 20h9"/><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/></svg></span>
      References
    </h2>
    <p class="refs">
      Wooldridge, J. M. (2025). <a href="https://link.springer.com/article/10.1007/s00181-024-02681-z"><em>Two-way fixed effects, the two-way Mundlak regression, and difference-in-differences estimators.</em></a> Empirical Economics, 69(5), 2545-2587.<br><br>
      Wooldridge, J. M. (2023). <a href="https://academic.oup.com/ectj/article/26/3/C31/7039335"><em>Simple approaches to nonlinear difference-in-differences with panel data.</em></a> The Econometrics Journal, 26(3), C31-C66.<br><br>
      Callaway, B. and Sant'Anna, P. H. (2021). <em>Difference-in-differences with multiple time periods.</em> Journal of Econometrics, 225(2), 200-230.<br><br>
      Wong, J., Forsell, E., Lewis, R., Mao, T., and Wardrop, M. (2021). <a href="https://arxiv.org/abs/2102.11297"><em>You only compress once: Optimal data compression for estimating linear models.</em></a> arXiv:2102.11297.
    </p>
  </div>

  <div class="card">
    <h2>
      <span class="icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg></span>
      Acknowledgments
    </h2>
    <p>
      This package relies on several high-quality open-source projects. Estimation uses <a href="https://github.com/py-econometrics/pyfixest">pyfixest</a> for high-dimensional fixed effects regression. The API and methodology draw heavily from Grant McDermott's <a href="https://github.com/grantmcdermott/etwfe">etwfe</a> package for R. We thank the developers of these projects for their contributions to accessible econometric software.
    </p>
  </div>

</div>

<footer>
  <div class="footer-inner">
    <div class="footer-links">
      <a href="https://pypi.org/project/etwfe/">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/></svg>
        PyPI
      </a>
      <a href="https://github.com/armandkapllani/etwfe">
        <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg>
        GitHub
      </a>
    </div>
    <div class="footer-dev">
      Developed by <a href="https://github.com/armandkapllani">Armand Kapllani</a>
    </div>
    <div class="footer-made">
      Made with ♥ for the econometrics community
    </div>
  </div>
</footer>

<script>
function copyCode(btn) {
  const code = btn.closest('.code').querySelector('code').innerText;
  navigator.clipboard.writeText(code);
  btn.textContent = '✓ Copied';
  setTimeout(() => btn.textContent = 'Copy', 2000);
}
</script>

</body>
</html>
