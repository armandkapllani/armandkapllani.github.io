<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>etwfe — Extended Two-Way Fixed Effects</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #ffffff;
      --bg-secondary: #f8fafc;
      --sidebar-bg: #0f172a;
      --text: #1e293b;
      --text-secondary: #475569;
      --border: #e2e8f0;
      --link: #2563eb;
      --code-bg: #1e293b;
      --code-text: #e2e8f0;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      font-size: 15px;
      line-height: 1.7;
      color: var(--text);
      background: var(--bg);
      -webkit-font-smoothing: antialiased;
    }

    a { color: var(--link); text-decoration: none; }
    a:hover { text-decoration: underline; }

    /* Layout */
    .layout {
      display: grid;
      grid-template-columns: 280px 1fr;
      min-height: 100vh;
    }

    /* Sidebar */
    .sidebar {
      background: var(--sidebar-bg);
      padding: 32px 24px;
      position: sticky;
      top: 0;
      height: 100vh;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
    }

    .sidebar-header {
      margin-bottom: 32px;
    }

    .logo {
      font-family: 'JetBrains Mono', monospace;
      font-size: 1.75rem;
      font-weight: 700;
      color: #fff;
      margin-bottom: 4px;
    }

    .tagline {
      font-size: 12px;
      color: #64748b;
    }

    .install-box {
      background: #1e293b;
      border: 1px solid #334155;
      padding: 12px 14px;
      border-radius: 6px;
      font-family: 'JetBrains Mono', monospace;
      font-size: 13px;
      color: #e2e8f0;
      margin-bottom: 32px;
    }

    .install-box .prompt { color: #64748b; }

    .nav-section {
      margin-bottom: 24px;
    }

    .nav-label {
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: #64748b;
      margin-bottom: 12px;
    }

    .nav-links {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .nav-link {
      color: #94a3b8;
      font-size: 14px;
      padding: 8px 12px;
      border-radius: 6px;
      transition: all 0.15s;
    }

    .nav-link:hover {
      color: #fff;
      background: #1e293b;
      text-decoration: none;
    }

    /* Main Content */
    .main {
      padding: 0 64px 80px;
      max-width: 900px;
    }

    .main-header {
      display: flex;
      gap: 20px;
      padding: 20px 0;
      margin-bottom: 32px;
      border-bottom: 1px solid var(--border);
      position: sticky;
      top: 0;
      background: var(--bg);
      z-index: 10;
    }

    .header-link {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 13px;
      font-weight: 500;
      color: var(--text-secondary);
      padding: 6px 12px;
      border-radius: 6px;
      transition: all 0.15s;
    }

    .header-link:hover {
      color: var(--text);
      background: var(--bg-secondary);
      text-decoration: none;
    }

    .header-link svg {
      width: 16px;
      height: 16px;
    }

    section {
      margin-bottom: 56px;
    }

    h1 {
      font-size: 2rem;
      font-weight: 700;
      color: var(--text);
      margin-bottom: 16px;
    }

    h2 {
      font-size: 1.4rem;
      font-weight: 600;
      color: var(--text);
      margin-bottom: 16px;
      padding-bottom: 12px;
      border-bottom: 1px solid var(--border);
    }

    h3 {
      font-size: 1.1rem;
      font-weight: 600;
      color: var(--text);
      margin: 32px 0 12px;
    }

    p { margin-bottom: 16px; color: var(--text-secondary); }

    p code, li code {
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.85em;
      background: #f1f5f9;
      padding: 2px 6px;
      border-radius: 4px;
      color: #0f172a;
    }

    ul, ol { margin-bottom: 16px; padding-left: 24px; color: var(--text-secondary); }
    li { margin-bottom: 8px; }

    strong { color: var(--text); }

    /* Code */
    .code-block {
      background: var(--code-bg);
      border-radius: 8px;
      margin: 20px 0;
      overflow: hidden;
    }

    .code-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 16px;
      background: #0f172a;
      border-bottom: 1px solid #334155;
    }

    .code-lang {
      font-family: 'JetBrains Mono', monospace;
      font-size: 12px;
      font-weight: 500;
      color: #64748b;
    }

    .copy-btn {
      background: transparent;
      border: 1px solid #475569;
      color: #94a3b8;
      padding: 4px 10px;
      border-radius: 4px;
      font-size: 11px;
      font-weight: 500;
      cursor: pointer;
      font-family: 'Inter', sans-serif;
    }

    .copy-btn:hover { border-color: #94a3b8; color: #e2e8f0; }

    pre {
      margin: 0;
      padding: 16px;
      overflow-x: auto;
    }

    pre code {
      font-family: 'JetBrains Mono', monospace;
      font-size: 13px;
      line-height: 1.6;
      color: var(--code-text);
      background: none;
      padding: 0;
    }

    /* Syntax */
    .kw { color: #c586c0; }
    .fn { color: #dcdcaa; }
    .str { color: #ce9178; }
    .num { color: #b5cea8; }
    .cmt { color: #6a9955; }
    .op { color: #d4d4d4; }

    /* Output */
    .output {
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 8px;
      margin: 20px 0;
      overflow: hidden;
    }

    .output-header {
      padding: 10px 16px;
      font-size: 12px;
      font-weight: 600;
      color: var(--text-secondary);
      background: #fff;
      border-bottom: 1px solid var(--border);
      text-transform: uppercase;
      letter-spacing: 0.025em;
    }

    .output pre {
      font-family: 'JetBrains Mono', monospace;
      font-size: 12px;
      line-height: 1.5;
      color: var(--text);
      padding: 16px;
      background: none;
    }

    /* Tables */
    .table-wrap {
      overflow-x: auto;
      margin: 20px 0;
      border: 1px solid var(--border);
      border-radius: 8px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 13px;
    }

    th, td {
      text-align: left;
      padding: 12px 16px;
      border-bottom: 1px solid var(--border);
    }

    th {
      font-weight: 600;
      background: var(--bg-secondary);
      color: var(--text-secondary);
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.025em;
    }

    td { color: var(--text-secondary); }

    tr:last-child td { border-bottom: none; }

    .param { color: var(--link); font-weight: 500; }

    /* Refs */
    .refs {
      font-size: 14px;
      color: var(--text-secondary);
      line-height: 2;
    }

    .refs em { color: var(--text); }

    /* Main Footer */
    .main-footer {
      margin-top: 64px;
      padding-top: 32px;
      border-top: 1px solid var(--border);
      text-align: center;
    }

    .main-footer p {
      font-size: 14px;
      color: var(--text-secondary);
    }

    .main-footer a {
      color: var(--text);
      font-weight: 500;
    }

    /* Mobile */
    @media (max-width: 900px) {
      .layout {
        grid-template-columns: 1fr;
      }
      .sidebar {
        position: relative;
        height: auto;
      }
      .main {
        padding: 0 24px 64px;
      }
      .main-header {
        flex-wrap: wrap;
        gap: 10px;
      }
    }
  </style>
</head>
<body>

<div class="layout">
  <aside class="sidebar">
    <div class="sidebar-header">
      <div class="logo">etwfe</div>
      <div class="tagline">Extended Two-Way Fixed Effects</div>
    </div>

    <div class="install-box">
      <span class="prompt">$ </span>pip install etwfe
    </div>

    <nav class="nav-section">
      <div class="nav-label">Documentation</div>
      <div class="nav-links">
        <a href="#background" class="nav-link">Background</a>
        <a href="#installation" class="nav-link">Installation</a>
        <a href="#sample-data" class="nav-link">Sample Data</a>
        <a href="#core-workflow" class="nav-link">Core Workflow</a>
        <a href="#visualizations" class="nav-link">Visualizations</a>
        <a href="#heterogeneity" class="nav-link">Effect Heterogeneity</a>
        <a href="#nonlinear" class="nav-link">Nonlinear Specs</a>
        <a href="#performance" class="nav-link">Performance</a>
        <a href="#reference" class="nav-link">API Reference</a>
      </div>
    </nav>

    <nav class="nav-section">
      <div class="nav-label">Resources</div>
      <div class="nav-links">
        <a href="#references" class="nav-link">References</a>
        <a href="#acknowledgments" class="nav-link">Acknowledgments</a>
      </div>
    </nav>
  </aside>

  <main class="main">
    <header class="main-header">
      <a href="https://pypi.org/project/etwfe/" class="header-link">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/></svg>
        PyPI
      </a>
      <a href="https://github.com/armandkapllani/etwfe" class="header-link">
        <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg>
        GitHub
      </a>
      <a href="https://github.com/armandkapllani/etwfe/issues" class="header-link">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
        Report a Bug
      </a>
      <a href="https://github.com/grantmcdermott/etwfe" class="header-link">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg>
        R Package
      </a>
    </header>

    <section id="background">
      <h1>etwfe</h1>
      <p>
        The <strong>etwfe</strong> package brings Wooldridge's Extended Two-Way Fixed Effects methodology to Python. It is a Python implementation inspired by the <a href="https://github.com/grantmcdermott/etwfe">etwfe R package</a> created by <a href="https://grantmcdermott.com/">Grant McDermott</a>. R users may prefer the <a href="https://github.com/grantmcdermott/etwfe">original R package</a>.
      </p>
      <p>
        Researchers commonly use two-way fixed effects (TWFE) regressions—models that include both unit and time fixed effects—when analyzing panel data to estimate causal effects. This technique removes time-invariant unit characteristics and common temporal shocks, leaving variation that can plausibly identify treatment effects when the standard difference-in-differences assumptions hold.
      </p>
      <p>
        Methodologists recently uncovered problems with applying naive TWFE specifications to settings where treatment adoption is staggered across units. The culprit is not the fixed effects themselves but rather the overly restrictive assumption that treatment effects are constant across all cohorts and time periods. When effects actually differ—for example, growing over time or varying by when units adopted treatment—the standard approach conflates these heterogeneous effects in ways that can produce misleading estimates.
      </p>
      <p>
        Wooldridge (2023, 2025) proposed a clean solution: include all interactions between treatment status, cohort membership, and time periods. This saturated specification—termed extended TWFE (ETWFE)—recovers cohort-time-specific treatment effects that researchers can then combine into summary measures: overall average effects, dynamic event-study patterns, or comparisons across treatment cohorts.
      </p>
      <p>
        A notable theoretical finding is that several different estimation approaches—imputation methods, pooled OLS with appropriate dummies, random effects, and TWFE itself—all yield identical point estimates when applied to this flexible model. Furthermore, these estimates match those from the regression-based estimators in Callaway and Sant'Anna (2021), linking ETWFE directly to other modern difference-in-differences methods.
      </p>
      <p>
        The methodology also accommodates nonlinear outcomes. When dealing with binary responses, count data, or fractional outcomes, assuming parallel trends in levels may be unrealistic. Wooldridge (2023) demonstrates that pooled quasi-maximum likelihood estimation using appropriate link functions identifies treatment effects under an index version of parallel trends—maintaining the same equivalence properties as the linear case.
      </p>
      <p>
        This Python package handles the tedious work of building the saturated interaction specification, performs estimation through high-dimensional fixed effects or quasi-MLE, and extracts interpretable treatment effect estimates with proper standard errors.
      </p>
    </section>

    <section id="installation">
      <h2>Installation</h2>
      <p>
        Install etwfe from PyPI using pip:
      </p>

      <div class="code-block">
        <div class="code-header">
          <span class="code-lang">shell</span>
          <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        </div>
        <pre><code>pip install etwfe</code></pre>
      </div>

      <p>
        The package requires Python 3.8 or higher. Dependencies including <code>pyfixest</code>, <code>pandas</code>, and <code>numpy</code> will be installed automatically.
      </p>
    </section>

    <section id="sample-data">
      <h2>Sample Data</h2>
      <p>
        The examples in this guide use <code>mpdta</code>, a panel dataset tracking teen employment in 500 U.S. counties from 2003 through 2007. Some counties implemented minimum wage increases in 2004, 2006, or 2007, while others never raised their minimum wage—creating a textbook staggered adoption design for difference-in-differences analysis.
      </p>

      <div class="code-block">
        <div class="code-header">
          <span class="code-lang">python</span>
          <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        </div>
        <pre><code><span class="kw">from</span> etwfe <span class="kw">import</span> etwfe
<span class="kw">import</span> pyreadr

<span class="cmt"># Retrieve the dataset</span>
url <span class="op">=</span> <span class="str">"https://github.com/bcallaway11/did/raw/master/data/mpdta.rda"</span>
pyreadr.<span class="fn">download_file</span>(url, <span class="str">"mpdta.rda"</span>)
mpdta <span class="op">=</span> pyreadr.<span class="fn">read_r</span>(<span class="str">"mpdta.rda"</span>)[<span class="str">"mpdta"</span>]

<span class="cmt"># Set up the variables</span>
mpdta[<span class="str">"first_treat"</span>] <span class="op">=</span> mpdta[<span class="str">"first.treat"</span>].<span class="fn">astype</span>(<span class="num">int</span>)
mpdta[<span class="str">"year"</span>] <span class="op">=</span> mpdta[<span class="str">"year"</span>].<span class="fn">astype</span>(<span class="num">int</span>)
mpdta[<span class="str">"countyreal"</span>] <span class="op">=</span> mpdta[<span class="str">"countyreal"</span>].<span class="fn">astype</span>(<span class="num">int</span>)

mpdta.<span class="fn">head</span>()</code></pre>
      </div>

      <div class="output">
        <div class="output-header">Output</div>
        <pre>    year  countyreal      lpop      lemp  first.treat  treat  first_treat
866 2003        8001  5.896761  8.461469         2007      1         2007
841 2004        8001  5.896761  8.336870         2007      1         2007
842 2005        8001  5.896761  8.340217         2007      1         2007
819 2006        8001  5.896761  8.378161         2007      1         2007
827 2007        8001  5.896761  8.487352         2007      1         2007</pre>
      </div>

      <p>
        The outcome of interest is <code>lemp</code>, which records log teen employment. The <code>first_treat</code> column indicates the year a county first saw a minimum wage increase (with 0 denoting counties that never experienced an increase). We also have <code>lpop</code> (log population) available as a potential covariate.
      </p>
    </section>

    <section id="core-workflow">
      <h2>Core Workflow</h2>
      <p>
        Analysis with <strong>etwfe</strong> proceeds in two stages. First, <code>etwfe()</code> fits the saturated interaction specification. Second, <code>emfx()</code> transforms the many coefficient estimates into meaningful treatment effect summaries.
      </p>

      <h3>Fitting the Model</h3>
      <p>
        The <code>etwfe()</code> function requires a formula identifying the outcome and any covariates, plus arguments specifying the time period variable, treatment cohort variable, and the data. Clustering standard errors by unit is generally advisable for panel data.
      </p>

      <div class="code-block">
        <div class="code-header">
          <span class="code-lang">python</span>
          <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        </div>
        <pre><code>mod <span class="op">=</span> <span class="fn">etwfe</span>(
    fml<span class="op">=</span><span class="str">"lemp ~ lpop"</span>,          <span class="cmt"># outcome ~ covariates</span>
    tvar<span class="op">=</span><span class="str">"year"</span>,                <span class="cmt"># time period</span>
    gvar<span class="op">=</span><span class="str">"first_treat"</span>,         <span class="cmt"># treatment cohort</span>
    data<span class="op">=</span>mpdta,
    vcov<span class="op">=</span>{<span class="str">"CRV1"</span>: <span class="str">"countyreal"</span>}  <span class="cmt"># cluster by county</span>
)</code></pre>
      </div>

      <p>
        Behind the scenes, the function constructs treatment indicators and fully interacts them with cohort and time dummies. The fitted object wraps a pyfixest regression, so methods like <code>.summary()</code> work as expected. However, the raw interaction coefficients lack direct interpretation—that's where <code>emfx()</code> becomes essential.
      </p>

      <h3>Extracting Treatment Effects</h3>
      <p>
        The <code>emfx()</code> method aggregates the interaction coefficients into interpretable treatment effect estimates. A basic call produces the overall average treatment effect on the treated:
      </p>

      <div class="code-block">
        <div class="code-header">
          <span class="code-lang">python</span>
          <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        </div>
        <pre><code><span class="cmt"># Overall average effect</span>
mod.<span class="fn">emfx</span>()</code></pre>
      </div>

      <div class="output">
        <div class="output-header">Average Treatment Effect</div>
        <pre>   _Dtreat  estimate  std.error  conf.low  conf.high
0      1.0 -0.050627   0.012497 -0.075122  -0.026132</pre>
      </div>

      <p>
        The estimate of −0.051 implies that minimum wage increases lowered teen employment by roughly 5% on average across treated counties and post-treatment periods. The confidence interval excludes zero, indicating statistical significance.
      </p>
      <p>
        The <code>type</code> parameter controls how effects are broken down. Setting <code>type="event"</code> generates an event study that tracks effects relative to treatment timing:
      </p>

      <div class="code-block">
        <div class="code-header">
          <span class="code-lang">python</span>
          <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        </div>
        <pre><code><span class="cmt"># Dynamic event study</span>
mod.<span class="fn">emfx</span>(type<span class="op">=</span><span class="str">"event"</span>)</code></pre>
      </div>

      <div class="output">
        <div class="output-header">Event Study</div>
        <pre>   event  estimate  std.error  conf.low  conf.high
0      0 -0.033212   0.013366 -0.059409  -0.007015
1      1 -0.057346   0.017150 -0.090959  -0.023732
2      2 -0.137870   0.030788 -0.198216  -0.077525
3      3 -0.109539   0.032315 -0.172877  -0.046202</pre>
      </div>

      <p>
        The event study uncovers interesting dynamics: effects begin modestly (−3.3% at the treatment date) but amplify substantially over subsequent years, peaking at −13.8% two years after adoption before moderating slightly.
      </p>
    </section>

    <section id="visualizations">
      <h2>Creating Visualizations</h2>

      <h3>Event Study Plots</h3>
      <p>
        The <code>plot()</code> method generates ready-to-use visualizations. The default style shows point estimates with error bars:
      </p>

      <div class="code-block">
        <div class="code-header">
          <span class="code-lang">python</span>
          <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        </div>
        <pre><code>mod.<span class="fn">plot</span>(type<span class="op">=</span><span class="str">"event"</span>)</code></pre>
      </div>

      <p>
        When using the default <code>cgroup="notyet"</code> control group, pre-treatment coefficients are mechanically zero because not-yet-treated observations serve as controls during those periods. To assess whether parallel trends held before treatment—a crucial diagnostic—restrict the comparison group to never-treated units:
      </p>

      <div class="code-block">
        <div class="code-header">
          <span class="code-lang">python</span>
          <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        </div>
        <pre><code>mod_never <span class="op">=</span> <span class="fn">etwfe</span>(
    fml<span class="op">=</span><span class="str">"lemp ~ lpop"</span>,
    tvar<span class="op">=</span><span class="str">"year"</span>,
    gvar<span class="op">=</span><span class="str">"first_treat"</span>,
    data<span class="op">=</span>mpdta,
    cgroup<span class="op">=</span><span class="str">"never"</span>,              <span class="cmt"># only never-treated as controls</span>
    vcov<span class="op">=</span>{<span class="str">"CRV1"</span>: <span class="str">"countyreal"</span>}
)

<span class="cmt"># Include pre-treatment periods</span>
mod_never.<span class="fn">emfx</span>(type<span class="op">=</span><span class="str">"event"</span>, post_only<span class="op">=</span><span class="kw">False</span>)</code></pre>
      </div>

      <div class="output">
        <div class="output-header">Event Study with Pre-Treatment</div>
        <pre>   event  estimate  std.error  conf.low  conf.high
0     -4  0.006896   0.024689 -0.041495   0.055287
1     -3  0.027595   0.018148 -0.007976   0.063166
2     -2  0.023465   0.014531 -0.005017   0.051947
3     -1  0.000000   0.000000  0.000000   0.000000
4      0 -0.021147   0.011394 -0.043478   0.001185
5      1 -0.053356   0.015774 -0.084274  -0.022438
6      2 -0.141080   0.032289 -0.204367  -0.077793
7      3 -0.107544   0.032923 -0.172074  -0.043015</pre>
      </div>

      <p>
        The pre-treatment estimates (events −4 through −2) cluster near zero with confidence intervals spanning it, supporting the parallel trends assumption. For a smoother visual, use ribbon-style confidence bands:
      </p>

      <div class="code-block">
        <div class="code-header">
          <span class="code-lang">python</span>
          <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        </div>
        <pre><code>mod_never.<span class="fn">plot</span>(type<span class="op">=</span><span class="str">"event"</span>, post_only<span class="op">=</span><span class="kw">False</span>, style<span class="op">=</span><span class="str">"ribbon"</span>)</code></pre>
      </div>
    </section>

    <section id="heterogeneity">
      <h2>Effect Heterogeneity</h2>
      <p>
        Treatment effects frequently differ across subpopulations. The <code>xvar</code> parameter enables estimation of heterogeneous effects by interacting treatment with a categorical moderator.
      </p>
      <p>
        As an illustration, we can test whether minimum wage impacts differ between Great Lakes states and other regions:
      </p>

      <div class="code-block">
        <div class="code-header">
          <span class="code-lang">python</span>
          <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        </div>
        <pre><code><span class="cmt"># Flag Great Lakes states by FIPS code</span>
great_lakes <span class="op">=</span> [<span class="num">17</span>, <span class="num">18</span>, <span class="num">26</span>, <span class="num">27</span>, <span class="num">36</span>, <span class="num">39</span>, <span class="num">42</span>, <span class="num">55</span>]
mpdta[<span class="str">"gls"</span>] <span class="op">=</span> mpdta[<span class="str">"countyreal"</span>].<span class="fn">astype</span>(<span class="num">str</span>).<span class="fn">str</span>[:<span class="num">2</span>].<span class="fn">astype</span>(<span class="num">int</span>).<span class="fn">isin</span>(great_lakes)</code></pre>
      </div>

      <p>
        With <code>xvar</code> specified, <code>emfx(by_xvar=True)</code> produces separate estimates for each subgroup:
      </p>

      <div class="code-block">
        <div class="code-header">
          <span class="code-lang">python</span>
          <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        </div>
        <pre><code>hmod <span class="op">=</span> <span class="fn">etwfe</span>(
    fml<span class="op">=</span><span class="str">"lemp ~ lpop"</span>,
    tvar<span class="op">=</span><span class="str">"year"</span>,
    gvar<span class="op">=</span><span class="str">"first_treat"</span>,
    data<span class="op">=</span>mpdta,
    cgroup<span class="op">=</span><span class="str">"never"</span>,
    xvar<span class="op">=</span><span class="str">"gls"</span>,                  <span class="cmt"># heterogeneity dimension</span>
    vcov<span class="op">=</span>{<span class="str">"CRV1"</span>: <span class="str">"countyreal"</span>}
)

<span class="cmt"># Subgroup-specific effects</span>
hmod.<span class="fn">emfx</span>(by_xvar<span class="op">=</span><span class="kw">True</span>)</code></pre>
      </div>

      <div class="output">
        <div class="output-header">Effects by Region</div>
        <pre>   estimate  std.error  conf.low  conf.high  _Dtreat    gls
0 -0.051920   0.034637 -0.119809   0.015969      1.0  False
1 -0.039396   0.024296 -0.087016   0.008223      1.0   True</pre>
      </div>

      <p>
        Both regions exhibit negative point estimates, though the confidence intervals overlap considerably—the regional difference doesn't appear statistically meaningful. Visualize the heterogeneous event study with:
      </p>

      <div class="code-block">
        <div class="code-header">
          <span class="code-lang">python</span>
          <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        </div>
        <pre><code>hmod.<span class="fn">plot</span>(type<span class="op">=</span><span class="str">"event"</span>, by_xvar<span class="op">=</span><span class="kw">True</span>, style<span class="op">=</span><span class="str">"ribbon"</span>)</code></pre>
      </div>
    </section>

    <section id="nonlinear">
      <h2>Nonlinear Specifications</h2>
      <p>
        Standard ETWFE presumes that treated and control groups follow parallel trajectories in outcome levels. This "linear parallel trends" assumption becomes questionable when outcomes have bounded ranges or skewed distributions.
      </p>

      <h3>When Linear Assumptions Strain</h3>
      <p>
        Consider binary outcomes where baseline rates differ markedly between groups—say 15% versus 40%. Expecting parallel evolution in probability levels may be implausible; perhaps trends should be parallel in log-odds instead. Analogous concerns arise with count data clustering near zero, or fractional responses constrained between 0 and 1.
      </p>
      <p>
        Wooldridge (2023) developed nonlinear ETWFE estimators that assume parallel trends in an index (the linear predictor) rather than the outcome itself. For binary outcomes, this suggests logit; for counts, Poisson. These estimators preserve the same equivalence results as linear ETWFE—pooled quasi-MLE and imputation yield identical estimates.
      </p>

      <h3>Poisson Implementation</h3>
      <p>
        Here we apply Poisson regression to employment counts rather than log employment:
      </p>

      <div class="code-block">
        <div class="code-header">
          <span class="code-lang">python</span>
          <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        </div>
        <pre><code><span class="kw">import</span> numpy <span class="kw">as</span> np

<span class="cmt"># Convert to levels</span>
mpdta[<span class="str">"emp"</span>] <span class="op">=</span> np.<span class="fn">exp</span>(mpdta[<span class="str">"lemp"</span>])

<span class="cmt"># Poisson ETWFE</span>
mod_pois <span class="op">=</span> <span class="fn">etwfe</span>(
    fml<span class="op">=</span><span class="str">"emp ~ lpop"</span>,
    tvar<span class="op">=</span><span class="str">"year"</span>,
    gvar<span class="op">=</span><span class="str">"first_treat"</span>,
    data<span class="op">=</span>mpdta,
    vcov<span class="op">=</span>{<span class="str">"CRV1"</span>: <span class="str">"countyreal"</span>},
    family<span class="op">=</span><span class="str">"poisson"</span>
)

mod_pois.<span class="fn">emfx</span>(type<span class="op">=</span><span class="str">"event"</span>)</code></pre>
      </div>

      <div class="output">
        <div class="output-header">Poisson Event Study</div>
        <pre>   event   estimate  std.error    conf.low   conf.high
0      0 -25.349748  15.886320  -56.486936    5.787439
1      1   1.091751  40.295264  -77.886967   80.070469
2      2 -75.124632  23.154168 -120.506802  -29.742462
3      3 -101.823979  27.087814 -154.916095  -48.731864</pre>
      </div>
    </section>

    <section id="performance">
      <h2>Computational Efficiency</h2>
      <p>
        Model fitting via <code>etwfe()</code> runs quickly. The <code>emfx()</code> marginal effects calculation can slow down with large datasets due to the high dimensionality of interaction terms. Two strategies help manage computation time.
      </p>

      <h3>Omitting Standard Errors</h3>
      <p>
        Setting <code>vcov=False</code> skips variance-covariance estimation, which often dominates runtime. This returns point estimates only—useful for checking specifications before investing in full computation:
      </p>

      <div class="code-block">
        <div class="code-header">
          <span class="code-lang">python</span>
          <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        </div>
        <pre><code><span class="cmt"># Point estimates without standard errors</span>
mod.<span class="fn">emfx</span>(type<span class="op">=</span><span class="str">"event"</span>, vcov<span class="op">=</span><span class="kw">False</span>)</code></pre>
      </div>

      <h3>Data Compression</h3>
      <p>
        The <code>compress=True</code> option implements the data compression approach from Wong et al. (2021). The core insight is that for linear models, data can be reduced to sufficient statistics—aggregated summaries preserving all information needed for estimation.
      </p>

      <div class="code-block">
        <div class="code-header">
          <span class="code-lang">python</span>
          <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        </div>
        <pre><code><span class="cmt"># Compressed estimation</span>
mod.<span class="fn">emfx</span>(type<span class="op">=</span><span class="str">"event"</span>, compress<span class="op">=</span><span class="kw">True</span>)</code></pre>
      </div>
    </section>

    <section id="reference">
      <h2>API Reference</h2>

      <h3>etwfe()</h3>
      <p>Fit an Extended Two-Way Fixed Effects model.</p>

      <div class="table-wrap">
        <table>
          <tr><th>Argument</th><th>Type</th><th>Description</th></tr>
          <tr><td class="param">fml</td><td><code>str</code></td><td>Model formula: <code>"outcome ~ covariates"</code></td></tr>
          <tr><td class="param">tvar</td><td><code>str</code></td><td>Name of the time period variable</td></tr>
          <tr><td class="param">gvar</td><td><code>str</code></td><td>Name of the treatment cohort variable</td></tr>
          <tr><td class="param">data</td><td><code>DataFrame</code></td><td>Panel dataset</td></tr>
          <tr><td class="param">ivar</td><td><code>str</code></td><td>Unit identifier (optional)</td></tr>
          <tr><td class="param">xvar</td><td><code>str</code></td><td>Heterogeneity variable (optional)</td></tr>
          <tr><td class="param">cgroup</td><td><code>str</code></td><td><code>"notyet"</code> or <code>"never"</code></td></tr>
          <tr><td class="param">family</td><td><code>str</code></td><td>GLM family: <code>"poisson"</code>, <code>"logit"</code>, etc.</td></tr>
          <tr><td class="param">vcov</td><td><code>str | dict</code></td><td>Variance estimator</td></tr>
        </table>
      </div>

      <h3>model.emfx()</h3>
      <p>Calculate aggregated marginal effects.</p>

      <div class="table-wrap">
        <table>
          <tr><th>Argument</th><th>Type</th><th>Description</th></tr>
          <tr><td class="param">type</td><td><code>str</code></td><td><code>"simple"</code>, <code>"event"</code>, <code>"group"</code>, or <code>"calendar"</code></td></tr>
          <tr><td class="param">by_xvar</td><td><code>bool</code></td><td>Separate effects by xvar</td></tr>
          <tr><td class="param">post_only</td><td><code>bool</code></td><td>Post-treatment only</td></tr>
          <tr><td class="param">compress</td><td><code>bool</code></td><td>Data compression</td></tr>
          <tr><td class="param">vcov</td><td><code>bool</code></td><td>Compute standard errors</td></tr>
        </table>
      </div>

      <h3>model.plot()</h3>
      <p>Generate visualizations.</p>

      <div class="table-wrap">
        <table>
          <tr><th>Argument</th><th>Type</th><th>Description</th></tr>
          <tr><td class="param">type</td><td><code>str</code></td><td><code>"event"</code>, <code>"group"</code>, or <code>"calendar"</code></td></tr>
          <tr><td class="param">style</td><td><code>str</code></td><td><code>"errorbar"</code> or <code>"ribbon"</code></td></tr>
          <tr><td class="param">by_xvar</td><td><code>bool</code></td><td>Separate series by xvar</td></tr>
          <tr><td class="param">figsize</td><td><code>tuple</code></td><td>Figure dimensions</td></tr>
        </table>
      </div>
    </section>

    <section id="references">
      <h2>References</h2>
      <p class="refs">
        Wooldridge, J. M. (2025). <a href="https://link.springer.com/article/10.1007/s00181-024-02681-z"><em>Two-way fixed effects, the two-way Mundlak regression, and difference-in-differences estimators.</em></a> Empirical Economics, 69(5), 2545-2587.<br><br>
        Wooldridge, J. M. (2023). <a href="https://academic.oup.com/ectj/article/26/3/C31/7039335"><em>Simple approaches to nonlinear difference-in-differences with panel data.</em></a> The Econometrics Journal, 26(3), C31-C66.<br><br>
        Callaway, B. and Sant'Anna, P. H. (2021). <em>Difference-in-differences with multiple time periods.</em> Journal of Econometrics, 225(2), 200-230.<br><br>
        Wong, J., Forsell, E., Lewis, R., Mao, T., and Wardrop, M. (2021). <a href="https://arxiv.org/abs/2102.11297"><em>You only compress once: Optimal data compression for estimating linear models.</em></a> arXiv:2102.11297.
      </p>
    </section>

    <section id="acknowledgments">
      <h2>Acknowledgments</h2>
      <p>
        This package relies on several high-quality open-source projects. Estimation uses <a href="https://github.com/py-econometrics/pyfixest">pyfixest</a> for high-dimensional fixed effects regression. The API and methodology draw heavily from Grant McDermott's <a href="https://github.com/grantmcdermott/etwfe">etwfe</a> package for R.
      </p>
    </section>

    <footer class="main-footer">
      <p>Developed by <a href="https://github.com/armandkapllani">Armand Kapllani</a></p>
    </footer>
  </main>
</div>

<script>
function copyCode(btn) {
  const code = btn.closest('.code-block').querySelector('code').innerText;
  navigator.clipboard.writeText(code);
  btn.textContent = 'Copied!';
  setTimeout(() => btn.textContent = 'Copy', 2000);
}
</script>

</body>
</html>
