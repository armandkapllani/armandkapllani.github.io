<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="etwfe - Extended Two-Way Fixed Effects for Python">
  <title>etwfe — Extended Two-Way Fixed Effects</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <style>
    *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
    
    :root {
      --bg: #ffffff;
      --bg-secondary: #f8fafc;
      --sidebar-bg: #0f172a;
      --text: #1e293b;
      --text-secondary: #475569;
      --text-muted: #64748b;
      --border: #e2e8f0;
      --link: #2563eb;
      --code-bg: #0f172a;
      --accent: #3b82f6;
      --sidebar-w: 256px;
      --header-h: 56px;
    }

    html { scroll-behavior: smooth; scroll-padding-top: calc(var(--header-h) + 24px); }

    body {
      font-family: 'Inter', system-ui, -apple-system, sans-serif;
      font-size: 16px;
      line-height: 1.7;
      color: var(--text);
      background: var(--bg);
      -webkit-font-smoothing: antialiased;
      -webkit-text-size-adjust: 100%;
    }

    a { color: var(--link); text-decoration: none; }
    a:hover { text-decoration: underline; }

    /* ===== TOP HEADER ===== */
    .top-header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: var(--header-h);
      background: var(--bg);
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      padding: 0 16px;
      z-index: 100;
      gap: 12px;
    }

    .menu-toggle {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 40px;
      height: 40px;
      border: none;
      background: none;
      cursor: pointer;
      border-radius: 8px;
      color: var(--text);
    }

    .menu-toggle:hover { background: var(--bg-secondary); }
    .menu-toggle svg { width: 22px; height: 22px; }

    .top-brand {
      display: flex;
      align-items: center;
      gap: 8px;
      font-family: 'JetBrains Mono', monospace;
      font-weight: 700;
      font-size: 1.1rem;
      color: var(--text);
      text-decoration: none;
    }

    .top-brand:hover { text-decoration: none; }

    .top-version {
      font-size: 11px;
      font-weight: 500;
      color: var(--text-muted);
      background: var(--bg-secondary);
      padding: 2px 6px;
      border-radius: 4px;
      border: 1px solid var(--border);
    }

    .header-links {
      display: flex;
      align-items: center;
      gap: 6px;
      margin-left: auto;
    }

    .header-link {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 13px;
      font-weight: 500;
      color: var(--text-secondary);
      padding: 8px 12px;
      border-radius: 6px;
      transition: all 0.15s;
    }

    .header-link:hover {
      color: var(--text);
      background: var(--bg-secondary);
      text-decoration: none;
    }

    .header-link svg { width: 18px; height: 18px; }
    .header-link span { display: inline; }

    .header-link.github {
      background: var(--sidebar-bg);
      color: #fff;
    }

    .header-link.github:hover { background: #1e293b; color: #fff; }

    /* ===== SIDEBAR ===== */
    .sidebar-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.4);
      z-index: 200;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.25s, visibility 0.25s;
    }

    .sidebar-overlay.open { opacity: 1; visibility: visible; }

    .sidebar {
      position: fixed;
      top: 0;
      left: 0;
      width: var(--sidebar-w);
      height: 100vh;
      background: var(--sidebar-bg);
      z-index: 300;
      transform: translateX(-100%);
      transition: transform 0.25s ease;
      overflow-y: auto;
      overscroll-behavior: contain;
    }

    .sidebar.open { transform: translateX(0); }

    .sidebar-header {
      padding: 20px;
      border-bottom: 1px solid #1e293b;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .sidebar-brand {
      font-family: 'JetBrains Mono', monospace;
      font-weight: 700;
      font-size: 1.25rem;
      color: #fff;
    }

    .sidebar-close {
      width: 36px;
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #1e293b;
      border: none;
      border-radius: 8px;
      color: #94a3b8;
      cursor: pointer;
    }

    .sidebar-close:hover { color: #fff; }
    .sidebar-close svg { width: 20px; height: 20px; }

    .sidebar-content { padding: 20px; }

    .install-box {
      background: #1e293b;
      border: 1px solid #334155;
      border-radius: 8px;
      padding: 12px 14px;
      font-family: 'JetBrains Mono', monospace;
      font-size: 13px;
      color: #e2e8f0;
      margin-bottom: 24px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .install-box .prompt { color: #64748b; }

    .copy-install {
      background: none;
      border: none;
      color: #64748b;
      cursor: pointer;
      padding: 4px;
    }

    .copy-install:hover { color: #fff; }
    .copy-install svg { width: 16px; height: 16px; display: block; }

    .nav-section { margin-bottom: 24px; }

    .nav-title {
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: #64748b;
      margin-bottom: 12px;
    }

    .nav-list { list-style: none; }

    .nav-item a {
      display: block;
      padding: 10px 12px;
      font-size: 14px;
      color: #94a3b8;
      border-radius: 6px;
      margin-bottom: 2px;
      transition: all 0.15s;
    }

    .nav-item a:hover {
      color: #fff;
      background: #1e293b;
      text-decoration: none;
    }

    /* ===== MAIN CONTENT ===== */
    .main {
      padding-top: var(--header-h);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    .content {
      flex: 1;
      padding: 32px 20px 64px;
      max-width: 720px;
      margin: 0 auto;
      width: 100%;
    }

    section { margin-bottom: 48px; }

    h1 {
      font-size: 1.75rem;
      font-weight: 700;
      color: var(--text);
      margin-bottom: 12px;
      letter-spacing: -0.02em;
    }

    h2 {
      font-size: 1.35rem;
      font-weight: 600;
      color: var(--text);
      margin-bottom: 16px;
      padding-bottom: 10px;
      border-bottom: 1px solid var(--border);
    }

    h3 {
      font-size: 1.05rem;
      font-weight: 600;
      color: var(--text);
      margin: 28px 0 12px;
    }

    .lead {
      font-size: 1.1rem;
      color: var(--text-secondary);
      margin-bottom: 20px;
    }

    .badges {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 20px;
    }

    .badges img {
      height: 20px;
    }

    /* Plot containers */
    .plot-container {
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 20px;
      margin: 20px 0;
      text-align: center;
    }

    .plot-svg {
      max-width: 100%;
      height: auto;
    }

    .plot-caption {
      font-size: 13px;
      color: var(--text-muted);
      margin-top: 12px;
      margin-bottom: 0;
    }

    p { margin-bottom: 16px; color: var(--text-secondary); }

    p code, li code {
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.875em;
      background: var(--bg-secondary);
      padding: 2px 6px;
      border-radius: 4px;
      color: var(--text);
      border: 1px solid var(--border);
    }

    ul, ol { margin-bottom: 16px; padding-left: 24px; color: var(--text-secondary); }
    li { margin-bottom: 8px; }
    strong { color: var(--text); font-weight: 600; }

    /* Code blocks */
    .code-block {
      background: var(--code-bg);
      border-radius: 10px;
      margin: 20px 0;
      overflow: hidden;
    }

    .code-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 12px;
      background: #1e293b;
      border-bottom: 1px solid #334155;
    }

    .code-lang {
      font-family: 'JetBrains Mono', monospace;
      font-size: 11px;
      font-weight: 500;
      color: #64748b;
    }

    .copy-btn {
      background: none;
      border: 1px solid #475569;
      color: #94a3b8;
      padding: 4px 10px;
      border-radius: 4px;
      font-size: 11px;
      font-weight: 500;
      cursor: pointer;
      font-family: 'Inter', sans-serif;
    }

    .copy-btn:hover { border-color: #94a3b8; color: #fff; }

    pre {
      margin: 0;
      padding: 16px;
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
    }

    pre code {
      font-family: 'JetBrains Mono', monospace;
      font-size: 13px;
      line-height: 1.6;
      color: #e2e8f0;
      background: none;
      padding: 0;
      border: none;
    }

    .kw { color: #c586c0; }
    .fn { color: #dcdcaa; }
    .str { color: #ce9178; }
    .num { color: #b5cea8; }
    .cmt { color: #6a9955; }
    .op { color: #d4d4d4; }

    /* Output */
    .output {
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 10px;
      margin: 20px 0;
      overflow: hidden;
    }

    .output-header {
      padding: 8px 12px;
      font-size: 11px;
      font-weight: 600;
      color: var(--text-muted);
      background: #fff;
      border-bottom: 1px solid var(--border);
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .output pre {
      font-family: 'JetBrains Mono', monospace;
      font-size: 12px;
      line-height: 1.5;
      color: var(--text);
      padding: 12px;
    }

    /* Tables */
    .table-wrap {
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
      margin: 20px 0;
      border: 1px solid var(--border);
      border-radius: 10px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 14px;
      min-width: 480px;
    }

    th, td {
      text-align: left;
      padding: 10px 12px;
      border-bottom: 1px solid var(--border);
    }

    th {
      font-weight: 600;
      background: var(--bg-secondary);
      color: var(--text-muted);
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    td { color: var(--text-secondary); }
    tr:last-child td { border-bottom: none; }
    .param { color: var(--link); font-weight: 500; }

    /* Footer */
    .footer {
      padding: 24px 20px;
      border-top: 1px solid var(--border);
      text-align: center;
      font-size: 14px;
      color: var(--text-muted);
    }

    .footer a { color: var(--text-secondary); font-weight: 500; }
    .footer a:hover { color: var(--text); }

    .footer-links {
      display: flex;
      justify-content: center;
      gap: 24px;
      margin-top: 12px;
      flex-wrap: wrap;
    }

    /* ===== DESKTOP ===== */
    @media (min-width: 769px) {
      .menu-toggle { display: none; }
      .sidebar-overlay { display: none; }

      .sidebar {
        position: fixed;
        top: var(--header-h);
        left: 0;
        height: calc(100vh - var(--header-h));
        transform: translateX(0);
        border-right: 1px solid #1e293b;
      }

      .sidebar-header { display: none; }

      .main { margin-left: var(--sidebar-w); }

      .content {
        padding: 48px 40px 80px;
        max-width: 780px;
      }

      h1 { font-size: 2rem; }
      h2 { font-size: 1.5rem; }
    }

    /* ===== SMALL MOBILE ===== */
    @media (max-width: 400px) {
      .header-link span { display: none; }
      .header-link { padding: 8px; }
      h1 { font-size: 1.5rem; }
      pre code { font-size: 12px; }
    }
  </style>
</head>
<body>

<!-- Top Header -->
<header class="top-header">
  <button class="menu-toggle" onclick="openSidebar()" aria-label="Open menu">
    <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
      <path d="M4 6h16M4 12h16M4 18h16"/>
    </svg>
  </button>
  <a href="#" class="top-brand">
    Extended Two-Way Fixed Effects 
  </a>
  <div class="header-links">
    <a href="https://github.com/armandkapllani/etwfe" class="header-link github">
      <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg>
      <span>GitHub</span>
    </a>
    <a href="https://pypi.org/project/etwfe/" class="header-link"><span>PyPI</span></a>
    <a href="https://pepy.tech/project/etwfe" class="header-link"><span>Downloads</span></a>
    <a href="https://github.com/armandkapllani/etwfe#requirements" class="header-link"><span>Dependencies</span></a>
    <a href="https://github.com/armandkapllani/etwfe/issues" class="header-link"><span>Issues</span></a>
  </div>
</header>

<!-- Sidebar Overlay -->
<div class="sidebar-overlay" id="overlay" onclick="closeSidebar()"></div>

<!-- Sidebar -->
<nav class="sidebar" id="sidebar">
  <div class="sidebar-header">
    <span class="sidebar-brand">etwfe</span>
    <button class="sidebar-close" onclick="closeSidebar()" aria-label="Close menu">
      <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
        <path d="M6 18L18 6M6 6l12 12"/>
      </svg>
    </button>
  </div>
  <div class="sidebar-content">
    <div class="install-box">
      <code><span class="prompt">$ </span>pip install etwfe</code>
      <button class="copy-install" onclick="navigator.clipboard.writeText('pip install etwfe')" title="Copy">
        <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <rect x="9" y="9" width="13" height="13" rx="2"/>
          <path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/>
        </svg>
      </button>
    </div>

    <div class="nav-section">
      <div class="nav-title">Getting Started</div>
      <ul class="nav-list">
        <li class="nav-item"><a href="#intro" onclick="closeSidebar()">Introduction</a></li>
        <li class="nav-item"><a href="#install" onclick="closeSidebar()">Installation</a></li>
        <li class="nav-item"><a href="#quickstart" onclick="closeSidebar()">Sample Data</a></li>
      </ul>
    </div>

    <div class="nav-section">
      <div class="nav-title">Guide</div>
      <ul class="nav-list">
        <li class="nav-item"><a href="#workflow" onclick="closeSidebar()">Core Workflow</a></li>
        <li class="nav-item"><a href="#plots" onclick="closeSidebar()">Visualizations</a></li>
        <li class="nav-item"><a href="#heterogeneity" onclick="closeSidebar()">Effect Heterogeneity</a></li>
        <li class="nav-item"><a href="#nonlinear" onclick="closeSidebar()">Nonlinear Specs</a></li>
        <li class="nav-item"><a href="#performance" onclick="closeSidebar()">Performance</a></li>
      </ul>
    </div>

    <div class="nav-section">
      <div class="nav-title">Reference</div>
      <ul class="nav-list">
        <li class="nav-item"><a href="#api" onclick="closeSidebar()">API Reference</a></li>
        <li class="nav-item"><a href="#requirements" onclick="closeSidebar()">Requirements</a></li>
        <li class="nav-item"><a href="#refs" onclick="closeSidebar()">Citations</a></li>
        <li class="nav-item"><a href="#acknowledgments" onclick="closeSidebar()">Acknowledgments</a></li>
      </ul>
    </div>
  </div>
</nav>

<!-- Main Content -->
<main class="main">
  <div class="content">

    <section id="intro">
      <h1>etwfe</h1>
      <div class="badges">
        <a href="https://pypi.org/project/etwfe/"><img src="https://badge.fury.io/py/etwfe.svg" alt="PyPI version"></a>
        <a href="https://pepy.tech/project/etwfe"><img src="https://static.pepy.tech/badge/etwfe" alt="Downloads"></a>
        <a href="https://www.python.org/downloads/"><img src="https://img.shields.io/badge/python-3.9+-blue.svg" alt="Python 3.9+"></a>
        <a href="https://opensource.org/licenses/MIT"><img src="https://img.shields.io/badge/License-MIT-yellow.svg" alt="License: MIT"></a>
      </div>
      <p class="lead">
        Extended Two-Way Fixed Effects for Python — implementing Wooldridge's modern approach to difference-in-differences with staggered treatment adoption.
      </p>
      <p>
        Two-way fixed effects (TWFE) regressions are widely used for causal inference with panel data, but naive TWFE specifications produce misleading estimates when treatment adoption is staggered and effects vary across cohorts or time. Wooldridge (2023, 2025) proposed a clean solution: fully interact treatment status with cohort and time indicators. This saturated specification—extended TWFE (ETWFE)—recovers cohort-time-specific effects that can be aggregated into interpretable summaries like overall average effects or dynamic event studies.
      </p>
      <p>
        This Python package development was inspired by the excellent <a href="https://github.com/grantmcdermott/etwfe">etwfe R package</a> developed by <a href="https://grantmcdermott.com/">Grant McDermott</a>. It handles the tedious work of building the saturated interaction specification, performs estimation through high-dimensional fixed effects or quasi-MLE, and extracts interpretable treatment effect estimates with proper standard errors.
      </p>
    </section>

    <section id="install">
      <h2>Installation</h2>
      <div class="code-block">
        <div class="code-header">
          <span class="code-lang">shell</span>
          <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        </div>
        <pre><code>pip install etwfe</code></pre>
      </div>
      <p>Requires Python 3.8+. Dependencies install automatically.</p>
    </section>

    <section id="quickstart">
      <h2>Sample Data</h2>
      <p>
        The examples in this guide use <code>mpdta</code>, a panel dataset tracking teen employment in 500 U.S. counties from 2003 through 2007. Some counties implemented minimum wage increases in 2004, 2006, or 2007, while others never raised their minimum wage—creating a textbook staggered adoption design for difference-in-differences analysis.
      </p>

      <div class="code-block">
        <div class="code-header">
          <span class="code-lang">python</span>
          <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        </div>
        <pre><code><span class="kw">from</span> etwfe <span class="kw">import</span> etwfe
<span class="kw">import</span> pyreadr

<span class="cmt"># Retrieve the dataset</span>
url <span class="op">=</span> <span class="str">"https://github.com/bcallaway11/did/raw/master/data/mpdta.rda"</span>
pyreadr.<span class="fn">download_file</span>(url, <span class="str">"mpdta.rda"</span>)
mpdta <span class="op">=</span> pyreadr.<span class="fn">read_r</span>(<span class="str">"mpdta.rda"</span>)[<span class="str">"mpdta"</span>]

<span class="cmt"># Set up the variables</span>
mpdta[<span class="str">"first_treat"</span>] <span class="op">=</span> mpdta[<span class="str">"first.treat"</span>].<span class="fn">astype</span>(<span class="num">int</span>)
mpdta[<span class="str">"year"</span>] <span class="op">=</span> mpdta[<span class="str">"year"</span>].<span class="fn">astype</span>(<span class="num">int</span>)
mpdta[<span class="str">"countyreal"</span>] <span class="op">=</span> mpdta[<span class="str">"countyreal"</span>].<span class="fn">astype</span>(<span class="num">int</span>)

mpdta.<span class="fn">head</span>()</code></pre>
      </div>

      <div class="output">
        <div class="output-header">Output</div>
        <pre>    year  countyreal      lpop      lemp  first.treat  treat  first_treat
866 2003        8001  5.896761  8.461469         2007      1         2007
841 2004        8001  5.896761  8.336870         2007      1         2007
842 2005        8001  5.896761  8.340217         2007      1         2007
819 2006        8001  5.896761  8.378161         2007      1         2007
827 2007        8001  5.896761  8.487352         2007      1         2007</pre>
      </div>

      <p>
        The outcome of interest is <code>lemp</code>, which records log teen employment. The <code>first_treat</code> column indicates the year a county first saw a minimum wage increase (with 0 denoting counties that never experienced an increase). We also have <code>lpop</code> (log population) available as a potential covariate.
      </p>
    </section>

    <section id="workflow">
      <h2>Core Workflow</h2>
      <p>
        Analysis with <strong>etwfe</strong> proceeds in two stages. First, <code>etwfe()</code> fits the saturated interaction specification. Second, <code>emfx()</code> transforms the many coefficient estimates into meaningful treatment effect summaries.
      </p>

      <h3>Fitting the Model</h3>
      <p>
        The <code>etwfe()</code> function requires a formula identifying the outcome and any covariates, plus arguments specifying the time period variable, treatment cohort variable, and the data. Clustering standard errors by unit is generally advisable for panel data.
      </p>

      <div class="code-block">
        <div class="code-header">
          <span class="code-lang">python</span>
          <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        </div>
        <pre><code>mod <span class="op">=</span> <span class="fn">etwfe</span>(
    fml<span class="op">=</span><span class="str">"lemp ~ lpop"</span>,          <span class="cmt"># outcome ~ covariates</span>
    tvar<span class="op">=</span><span class="str">"year"</span>,                <span class="cmt"># time period</span>
    gvar<span class="op">=</span><span class="str">"first_treat"</span>,         <span class="cmt"># treatment cohort</span>
    data<span class="op">=</span>mpdta,
    vcov<span class="op">=</span>{<span class="str">"CRV1"</span>: <span class="str">"countyreal"</span>}  <span class="cmt"># cluster by county</span>
)</code></pre>
      </div>

      <p>
        Behind the scenes, the function constructs treatment indicators and fully interacts them with cohort and time dummies. The fitted object wraps a pyfixest regression, so methods like <code>.summary()</code> work as expected. However, the raw interaction coefficients lack direct interpretation—that's where <code>emfx()</code> becomes essential.
      </p>

      <h3>Extracting Treatment Effects</h3>
      <p>
        The <code>emfx()</code> method aggregates the interaction coefficients into interpretable treatment effect estimates. A basic call produces the overall average treatment effect on the treated:
      </p>

      <div class="code-block">
        <div class="code-header">
          <span class="code-lang">python</span>
          <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        </div>
        <pre><code><span class="cmt"># Overall average effect</span>
mod.<span class="fn">emfx</span>()</code></pre>
      </div>

      <div class="output">
        <div class="output-header">Average Treatment Effect</div>
        <pre>   _Dtreat  estimate  std.error  conf.low  conf.high
0      1.0 -0.050627   0.012497 -0.075122  -0.026132</pre>
      </div>

      <p>
        The estimate of −0.051 implies that minimum wage increases lowered teen employment by roughly 5% on average across treated counties and post-treatment periods. The confidence interval excludes zero, indicating statistical significance.
      </p>

      <p>
        The <code>type</code> parameter controls how effects are broken down. Setting <code>type="event"</code> generates an event study that tracks effects relative to treatment timing:
      </p>

      <div class="code-block">
        <div class="code-header">
          <span class="code-lang">python</span>
          <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        </div>
        <pre><code><span class="cmt"># Dynamic event study</span>
mod.<span class="fn">emfx</span>(type<span class="op">=</span><span class="str">"event"</span>)</code></pre>
      </div>

      <div class="output">
        <div class="output-header">Event Study</div>
        <pre>   event  estimate  std.error  conf.low  conf.high
0      0 -0.033212   0.013366 -0.059409  -0.007015
1      1 -0.057346   0.017150 -0.090959  -0.023732
2      2 -0.137870   0.030788 -0.198216  -0.077525
3      3 -0.109539   0.032315 -0.172877  -0.046202</pre>
      </div>

      <p>
        The event study uncovers interesting dynamics: effects begin modestly (−3.3% at the treatment date) but amplify substantially over subsequent years, peaking at −13.8% two years after adoption before moderating slightly.
      </p>
    </section>

    <section id="plots">
      <h2>Creating Visualizations</h2>

      <h3>Event Study Plots</h3>
      <p>
        The <code>plot()</code> method generates ready-to-use visualizations. The default style shows point estimates with error bars:
      </p>

      <div class="code-block">
        <div class="code-header">
          <span class="code-lang">python</span>
          <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        </div>
        <pre><code>mod.<span class="fn">plot</span>(type<span class="op">=</span><span class="str">"event"</span>)</code></pre>
      </div>

      <div class="plot-container">
        <img src="https://armandkapllani.github.io/etwfe/docs/event_study.png" alt="ETWFE Event Study" style="max-width: 100%; height: auto; border-radius: 8px;">
        <p class="plot-caption">Event study showing treatment effects relative to adoption timing</p>
      </div>

      <p>
        When using the default <code>cgroup="notyet"</code> control group, pre-treatment coefficients are mechanically zero because not-yet-treated observations serve as controls during those periods. To assess whether parallel trends held before treatment—a crucial diagnostic—restrict the comparison group to never-treated units:
      </p>

      <div class="code-block">
        <div class="code-header">
          <span class="code-lang">python</span>
          <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        </div>
        <pre><code>mod_never <span class="op">=</span> <span class="fn">etwfe</span>(
    fml<span class="op">=</span><span class="str">"lemp ~ lpop"</span>,
    tvar<span class="op">=</span><span class="str">"year"</span>,
    gvar<span class="op">=</span><span class="str">"first_treat"</span>,
    data<span class="op">=</span>mpdta,
    cgroup<span class="op">=</span><span class="str">"never"</span>,              <span class="cmt"># only never-treated as controls</span>
    vcov<span class="op">=</span>{<span class="str">"CRV1"</span>: <span class="str">"countyreal"</span>}
)

<span class="cmt"># Include pre-treatment periods</span>
mod_never.<span class="fn">emfx</span>(type<span class="op">=</span><span class="str">"event"</span>, post_only<span class="op">=</span><span class="kw">False</span>)</code></pre>
      </div>

      <div class="output">
        <div class="output-header">Event Study with Pre-Treatment</div>
        <pre>   event  estimate  std.error  conf.low  conf.high
0     -4  0.006896   0.024689 -0.041495   0.055287
1     -3  0.027595   0.018148 -0.007976   0.063166
2     -2  0.023465   0.014531 -0.005017   0.051947
3     -1  0.000000   0.000000  0.000000   0.000000
4      0 -0.021147   0.011394 -0.043478   0.001185
5      1 -0.053356   0.015774 -0.084274  -0.022438
6      2 -0.141080   0.032289 -0.204367  -0.077793
7      3 -0.107544   0.032923 -0.172074  -0.043015</pre>
      </div>

      <p>
        The pre-treatment estimates (events −4 through −2) cluster near zero with confidence intervals spanning it, supporting the parallel trends assumption. For a smoother visual, use ribbon-style confidence bands:
      </p>

      <div class="code-block">
        <div class="code-header">
          <span class="code-lang">python</span>
          <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        </div>
        <pre><code>mod_never.<span class="fn">plot</span>(type<span class="op">=</span><span class="str">"event"</span>, post_only<span class="op">=</span><span class="kw">False</span>, style<span class="op">=</span><span class="str">"ribbon"</span>)</code></pre>
      </div>

      <div class="plot-container">
        <img src="https://armandkapllani.github.io/etwfe/docs/event_study_ribbon.jpg" alt="ETWFE Event Study" style="max-width: 100%; height: auto; border-radius: 8px;">
        <p class="plot-caption">Event study with ribbon-style confidence bands</p>
      </div>

      <h3>Comparing Control Group Specifications</h3>
      <p>
        You can compare estimates across control group specifications using a regression table format:
      </p>

      <div class="code-block">
        <div class="code-header">
          <span class="code-lang">python</span>
          <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        </div>
        <pre><code><span class="kw">import</span> pandas <span class="kw">as</span> pd
<span class="kw">import</span> numpy <span class="kw">as</span> np

<span class="cmt"># Get event study results</span>
es_never <span class="op">=</span> mod_never.<span class="fn">emfx</span>(type<span class="op">=</span><span class="str">"event"</span>, post_only<span class="op">=</span><span class="kw">False</span>)[[<span class="str">"event"</span>, <span class="str">"estimate"</span>, <span class="str">"std.error"</span>]]
es_notyet <span class="op">=</span> mod.<span class="fn">emfx</span>(type<span class="op">=</span><span class="str">"event"</span>)[[<span class="str">"event"</span>, <span class="str">"estimate"</span>, <span class="str">"std.error"</span>]]

<span class="cmt"># Rename columns</span>
es_never.columns <span class="op">=</span> [<span class="str">"event"</span>, <span class="str">"est_1"</span>, <span class="str">"se_1"</span>]
es_notyet.columns <span class="op">=</span> [<span class="str">"event"</span>, <span class="str">"est_2"</span>, <span class="str">"se_2"</span>]

<span class="cmt"># Merge</span>
table <span class="op">=</span> es_never.<span class="fn">merge</span>(es_notyet, on<span class="op">=</span><span class="str">"event"</span>, how<span class="op">=</span><span class="str">"outer"</span>)
table <span class="op">=</span> table.<span class="fn">sort_values</span>(<span class="str">"event"</span>).<span class="fn">reset_index</span>(drop<span class="op">=</span><span class="kw">True</span>)

<span class="cmt"># Get model stats</span>
nobs_1 <span class="op">=</span> mod_never.model_._N
nobs_2 <span class="op">=</span> mod.model_._N
r2_1 <span class="op">=</span> mod_never.model_._r2
r2_2 <span class="op">=</span> mod.model_._r2
rmse_1 <span class="op">=</span> mod_never.model_._rmse
rmse_2 <span class="op">=</span> mod.model_._rmse

<span class="cmt"># Function to add significance stars</span>
<span class="kw">def</span> <span class="fn">add_stars</span>(est, se):
    <span class="kw">if</span> pd.<span class="fn">isna</span>(est) <span class="kw">or</span> pd.<span class="fn">isna</span>(se) <span class="kw">or</span> se <span class="op">==</span> <span class="num">0</span>:
        <span class="kw">return</span> <span class="str">f"{est:.3f}"</span> <span class="kw">if</span> pd.<span class="fn">notna</span>(est) <span class="kw">else</span> <span class="str">""</span>
    t <span class="op">=</span> <span class="fn">abs</span>(est <span class="op">/</span> se)
    <span class="kw">if</span> t <span class="op">></span> <span class="num">3.291</span>:
        <span class="kw">return</span> <span class="str">f"{est:.3f}***"</span>
    <span class="kw">elif</span> t <span class="op">></span> <span class="num">2.576</span>:
        <span class="kw">return</span> <span class="str">f"{est:.3f}**"</span>
    <span class="kw">elif</span> t <span class="op">></span> <span class="num">1.96</span>:
        <span class="kw">return</span> <span class="str">f"{est:.3f}*"</span>
    <span class="kw">elif</span> t <span class="op">></span> <span class="num">1.645</span>:
        <span class="kw">return</span> <span class="str">f"{est:.3f}+"</span>
    <span class="kw">else</span>:
        <span class="kw">return</span> <span class="str">f"{est:.3f}"</span>

<span class="cmt"># Build formatted output</span>
<span class="fn">print</span>(<span class="str">"\n"</span> <span class="op">+</span> <span class="str">"="</span><span class="op">*</span><span class="num">50</span>)
<span class="fn">print</span>(<span class="str">"                    Event Study"</span>)
<span class="fn">print</span>(<span class="str">"="</span><span class="op">*</span><span class="num">50</span>)
<span class="fn">print</span>(<span class="str">f"{'':30} {'(1)':>10} {'(2)':>10}"</span>)
<span class="fn">print</span>(<span class="str">"-"</span><span class="op">*</span><span class="num">50</span>)

<span class="kw">for</span> _, r <span class="kw">in</span> table.<span class="fn">iterrows</span>():
    evt <span class="op">=</span> <span class="fn">int</span>(r[<span class="str">"event"</span>])
    label <span class="op">=</span> <span class="str">f"Years post treatment = {evt}"</span>
    
    col1 <span class="op">=</span> <span class="fn">add_stars</span>(r[<span class="str">"est_1"</span>], r[<span class="str">"se_1"</span>]) <span class="kw">if</span> pd.<span class="fn">notna</span>(r[<span class="str">"est_1"</span>]) <span class="kw">else</span> <span class="str">""</span>
    col2 <span class="op">=</span> <span class="fn">add_stars</span>(r[<span class="str">"est_2"</span>], r[<span class="str">"se_2"</span>]) <span class="kw">if</span> pd.<span class="fn">notna</span>(r[<span class="str">"est_2"</span>]) <span class="kw">else</span> <span class="str">""</span>
    
    <span class="fn">print</span>(<span class="str">f"{label:30} {col1:>10} {col2:>10}"</span>)
    
    se1 <span class="op">=</span> <span class="str">f"({r['se_1']:.3f})"</span> <span class="kw">if</span> pd.<span class="fn">notna</span>(r[<span class="str">'se_1'</span>]) <span class="kw">and</span> r[<span class="str">'se_1'</span>] <span class="op">!=</span> <span class="num">0</span> <span class="kw">else</span> <span class="str">""</span>
    se2 <span class="op">=</span> <span class="str">f"({r['se_2']:.3f})"</span> <span class="kw">if</span> pd.<span class="fn">notna</span>(r[<span class="str">'se_2'</span>]) <span class="kw">else</span> <span class="str">""</span>
    
    <span class="fn">print</span>(<span class="str">f"{'':30} {se1:>10} {se2:>10}"</span>)

<span class="fn">print</span>(<span class="str">"-"</span><span class="op">*</span><span class="num">50</span>)
<span class="fn">print</span>(<span class="str">f"{'Num.Obs.':30} {nobs_1:>10} {nobs_2:>10}"</span>)
<span class="fn">print</span>(<span class="str">f"{'R2':30} {r2_1:>10.3f} {r2_2:>10.3f}"</span>)
<span class="fn">print</span>(<span class="str">f"{'RMSE':30} {rmse_1:>10.3f} {rmse_2:>10.3f}"</span>)
<span class="fn">print</span>(<span class="str">f"{'FE..first.treat':30} {'X':>10} {'X':>10}"</span>)
<span class="fn">print</span>(<span class="str">f"{'FE..year':30} {'X':>10} {'X':>10}"</span>)
<span class="fn">print</span>(<span class="str">"-"</span><span class="op">*</span><span class="num">50</span>)
<span class="fn">print</span>(<span class="str">"+ p < 0.1, * p < 0.05, ** p < 0.01, *** p < 0.001"</span>)
<span class="fn">print</span>(<span class="str">"Std. errors are clustered at the county level"</span>)
<span class="fn">print</span>(<span class="str">"="</span><span class="op">*</span><span class="num">50</span>)</code></pre>
      </div>

      <div class="output">
        <div class="output-header">Regression Comparison Table</div>
        <pre>==================================================
                    Event Study
==================================================
                                      (1)        (2)
--------------------------------------------------
Years post treatment = -4           0.007           
                                  (0.025)           
Years post treatment = -3           0.028           
                                  (0.018)           
Years post treatment = -2           0.023           
                                  (0.015)           
Years post treatment = -1           0.000           
                                                    
Years post treatment = 0          -0.021+    -0.033*
                                  (0.011)    (0.013)
Years post treatment = 1        -0.053***  -0.057***
                                  (0.016)    (0.017)
Years post treatment = 2        -0.141***  -0.138***
                                  (0.032)    (0.031)
Years post treatment = 3         -0.108**  -0.110***
                                  (0.033)    (0.032)
--------------------------------------------------
Num.Obs.                             2500       2500
R2                                  0.873      0.873
RMSE                                0.537      0.537
FE..first.treat                         X          X
FE..year                                X          X
--------------------------------------------------
+ p < 0.1, * p < 0.05, ** p < 0.01, *** p < 0.001
Std. errors are clustered at the county level
==================================================</pre>
      </div>

      <p>
        Column (1) uses never-treated controls (<code>cgroup="never"</code>) while column (2) uses not-yet-treated controls (<code>cgroup="notyet"</code>). The pre-treatment coefficients in column (1) support the parallel trends assumption. Post-treatment estimates are similar across specifications, with the largest effects occurring at event time 2.
      </p>

      <div class="code-block">
        <div class="code-header">
          <span class="code-lang">python</span>
          <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        </div>
        <pre><code>mod_never.<span class="fn">plot</span>(type<span class="op">=</span><span class="str">"event"</span>, post_only<span class="op">=</span><span class="kw">False</span>)</code></pre>
      </div>

      <div class="plot-container">
        <img src="https://armandkapllani.github.io/etwfe/docs/event_study_pretreatment.jpg" alt="ETWFE Event Study" style="max-width: 100%; height: auto; border-radius: 8px;">
        <p class="plot-caption">Event study with pre-treatment periods showing parallel trends validation</p>
      </div>
    </section>

    <section id="heterogeneity">
      <h2>Effect Heterogeneity</h2>
      <p>
        Treatment effects frequently differ across subpopulations. The <code>xvar</code> parameter enables estimation of heterogeneous effects by interacting treatment with a categorical moderator.
      </p>
      <p>
        As an illustration, we can test whether minimum wage impacts differ between Great Lakes states and other regions:
      </p>

      <div class="code-block">
        <div class="code-header">
          <span class="code-lang">python</span>
          <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        </div>
        <pre><code><span class="cmt"># Flag Great Lakes states by FIPS code</span>
great_lakes <span class="op">=</span> [<span class="num">17</span>, <span class="num">18</span>, <span class="num">26</span>, <span class="num">27</span>, <span class="num">36</span>, <span class="num">39</span>, <span class="num">42</span>, <span class="num">55</span>]
mpdta[<span class="str">"gls"</span>] <span class="op">=</span> mpdta[<span class="str">"countyreal"</span>].<span class="fn">astype</span>(<span class="num">str</span>).<span class="fn">str</span>[:<span class="num">2</span>].<span class="fn">astype</span>(<span class="num">int</span>).<span class="fn">isin</span>(great_lakes)</code></pre>
      </div>

      <p>
        With <code>xvar</code> specified, <code>emfx(by_xvar=True)</code> produces separate estimates for each subgroup:
      </p>

      <div class="code-block">
        <div class="code-header">
          <span class="code-lang">python</span>
          <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        </div>
        <pre><code>hmod <span class="op">=</span> <span class="fn">etwfe</span>(
    fml<span class="op">=</span><span class="str">"lemp ~ lpop"</span>,
    tvar<span class="op">=</span><span class="str">"year"</span>,
    gvar<span class="op">=</span><span class="str">"first_treat"</span>,
    data<span class="op">=</span>mpdta,
    cgroup<span class="op">=</span><span class="str">"never"</span>,
    xvar<span class="op">=</span><span class="str">"gls"</span>,                  <span class="cmt"># heterogeneity dimension</span>
    vcov<span class="op">=</span>{<span class="str">"CRV1"</span>: <span class="str">"countyreal"</span>}
)

<span class="cmt"># Subgroup-specific effects</span>
hmod.<span class="fn">emfx</span>(by_xvar<span class="op">=</span><span class="kw">True</span>)</code></pre>
      </div>

      <div class="output">
        <div class="output-header">Effects by Region</div>
        <pre>   estimate  std.error  conf.low  conf.high  _Dtreat    gls
0 -0.051920   0.034637 -0.119809   0.015969      1.0  False
1 -0.039396   0.024296 -0.087016   0.008223      1.0   True</pre>
      </div>

      <p>
        Both regions exhibit negative point estimates, though the confidence intervals overlap considerably—the regional difference doesn't appear statistically meaningful. Visualize the heterogeneous event study with:
      </p>

      <div class="code-block">
        <div class="code-header">
          <span class="code-lang">python</span>
          <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        </div>
        <pre><code>hmod.<span class="fn">plot</span>(type<span class="op">=</span><span class="str">"event"</span>, by_xvar<span class="op">=</span><span class="kw">True</span>, post_only<span class="op">=</span><span class="kw">False</span>, style<span class="op">=</span><span class="str">"ribbon"</span>)</code></pre>
      </div>

      <div class="plot-container">
        <img src="https://armandkapllani.github.io/etwfe/docs/heterogeneous_effects.jpg" alt="ETWFE Event Study" style="max-width: 100%; height: auto; border-radius: 8px;">
        <p class="plot-caption">Heterogeneous treatment effects by region (Great Lakes vs. Other)</p>
      </div>
    </section>

    <section id="nonlinear">
      <h2>Nonlinear Specifications</h2>
      <p>
        Standard ETWFE presumes that treated and control groups follow parallel trajectories in outcome levels. This "linear parallel trends" assumption becomes questionable when outcomes have bounded ranges or skewed distributions.
      </p>

      <h3>When Linear Assumptions Strain</h3>
      <p>
        Consider binary outcomes where baseline rates differ markedly between groups—say 15% versus 40%. Expecting parallel evolution in probability levels may be implausible; perhaps trends should be parallel in log-odds instead. Analogous concerns arise with count data clustering near zero, or fractional responses constrained between 0 and 1.
      </p>
      <p>
        Wooldridge (2023) developed nonlinear ETWFE estimators that assume parallel trends in an index (the linear predictor) rather than the outcome itself. For binary outcomes, this suggests logit; for counts, Poisson. These estimators preserve the same equivalence results as linear ETWFE—pooled quasi-MLE and imputation yield identical estimates.
      </p>

      <h3>Poisson Implementation</h3>
      <p>
        Here we apply Poisson regression to employment counts rather than log employment:
      </p>

      <div class="code-block">
        <div class="code-header">
          <span class="code-lang">python</span>
          <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        </div>
        <pre><code><span class="kw">import</span> numpy <span class="kw">as</span> np

<span class="cmt"># Convert to levels</span>
mpdta[<span class="str">"emp"</span>] <span class="op">=</span> np.<span class="fn">exp</span>(mpdta[<span class="str">"lemp"</span>])

<span class="cmt"># Poisson ETWFE</span>
mod_pois <span class="op">=</span> <span class="fn">etwfe</span>(
    fml<span class="op">=</span><span class="str">"emp ~ lpop"</span>,
    tvar<span class="op">=</span><span class="str">"year"</span>,
    gvar<span class="op">=</span><span class="str">"first_treat"</span>,
    data<span class="op">=</span>mpdta,
    vcov<span class="op">=</span>{<span class="str">"CRV1"</span>: <span class="str">"countyreal"</span>},
    family<span class="op">=</span><span class="str">"poisson"</span>
)

mod_pois.<span class="fn">emfx</span>(type<span class="op">=</span><span class="str">"event"</span>)</code></pre>
      </div>

      <div class="output">
        <div class="output-header">Poisson Event Study</div>
        <pre>   event   estimate  std.error    conf.low   conf.high
0      0 -25.349748  15.886320  -56.486936    5.787439
1      1   1.091751  40.295264  -77.886967   80.070469
2      2 -75.124632  23.154168 -120.506802  -29.742462
3      3 -101.823979  27.087814 -154.916095  -48.731864</pre>
      </div>

      <h3>Robustness Assessment</h3>
      <p>
        Even when linear parallel trends seems reasonable, running both linear and nonlinear models provides a valuable robustness check. When estimates align across specifications, confidence in the findings grows. When they diverge, it signals sensitivity to the functional form assumption—useful diagnostic information for interpreting results.
      </p>
    </section>

    <section id="performance">
      <h2>Computational Efficiency</h2>
      <p>
        Model fitting via <code>etwfe()</code> runs quickly. The <code>emfx()</code> marginal effects calculation can slow down with large datasets due to the high dimensionality of interaction terms. Two strategies help manage computation time.
      </p>

      <h3>Omitting Standard Errors</h3>
      <p>
        Setting <code>vcov=False</code> skips variance-covariance estimation, which often dominates runtime. This returns point estimates only—useful for checking specifications before investing in full computation:
      </p>

      <div class="code-block">
        <div class="code-header">
          <span class="code-lang">python</span>
          <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        </div>
        <pre><code><span class="cmt"># Point estimates without standard errors</span>
mod.<span class="fn">emfx</span>(type<span class="op">=</span><span class="str">"event"</span>, vcov<span class="op">=</span><span class="kw">False</span>)</code></pre>
      </div>

      <h3>Data Compression</h3>
      <p>
        The <code>compress=True</code> option implements the data compression approach from Wong et al. (2021). The core insight is that for linear models, data can be reduced to sufficient statistics—aggregated summaries preserving all information needed for estimation.
      </p>
      <p>
        Compression can shrink datasets with millions of observations to much smaller structures, enabling interactive analysis that would otherwise demand specialized infrastructure. Point estimates match uncompressed results exactly, while standard errors are approximate but typically accurate to 2-3 decimal places.
      </p>

      <div class="code-block">
        <div class="code-header">
          <span class="code-lang">python</span>
          <button class="copy-btn" onclick="copyCode(this)">Copy</button>
        </div>
        <pre><code><span class="cmt"># Compressed estimation</span>
mod.<span class="fn">emfx</span>(type<span class="op">=</span><span class="str">"event"</span>, compress<span class="op">=</span><span class="kw">True</span>)</code></pre>
      </div>

      <h3>Practical Approach</h3>
      <p>For large datasets, a staged approach works well:</p>
      <ol>
        <li>Run <code>emfx(vcov=False)</code> to verify point estimates look sensible</li>
        <li>Run <code>emfx(vcov=False, compress=True)</code> to confirm compression preserves estimates</li>
        <li>If results align, run <code>emfx(compress=True)</code> for approximate standard errors</li>
      </ol>
    </section>

    <section id="api">
      <h2>API Reference</h2>

      <h3>etwfe()</h3>
      <p>Fit an Extended Two-Way Fixed Effects model.</p>

      <div class="table-wrap">
        <table>
          <tr><th>Argument</th><th>Type</th><th>Description</th></tr>
          <tr><td class="param">fml</td><td><code>str</code></td><td>Model formula: <code>"outcome ~ covariates"</code> or <code>"outcome ~ 0"</code> for no covariates</td></tr>
          <tr><td class="param">tvar</td><td><code>str</code></td><td>Name of the time period variable</td></tr>
          <tr><td class="param">gvar</td><td><code>str</code></td><td>Name of the treatment cohort variable (period of first treatment; 0 = never treated)</td></tr>
          <tr><td class="param">data</td><td><code>DataFrame</code></td><td>Panel dataset containing all required variables</td></tr>
          <tr><td class="param">ivar</td><td><code>str</code></td><td>Unit identifier for unit-level fixed effects (optional)</td></tr>
          <tr><td class="param">xvar</td><td><code>str</code></td><td>Variable for heterogeneous treatment effects (optional)</td></tr>
          <tr><td class="param">tref</td><td><code>int</code></td><td>Reference time period (optional; defaults to earliest)</td></tr>
          <tr><td class="param">gref</td><td><code>int</code></td><td>Reference cohort (optional; defaults to 0 / never-treated)</td></tr>
          <tr><td class="param">cgroup</td><td><code>str</code></td><td>Control group: <code>"notyet"</code> (default) or <code>"never"</code></td></tr>
          <tr><td class="param">fe</td><td><code>str</code></td><td>Fixed effects: <code>"vs"</code>, <code>"feo"</code> (default), or <code>"none"</code></td></tr>
          <tr><td class="param">family</td><td><code>str</code></td><td>GLM family: <code>"poisson"</code>, <code>"logit"</code>, <code>"probit"</code>, etc.</td></tr>
          <tr><td class="param">vcov</td><td><code>str | dict</code></td><td>Variance estimator, e.g., <code>{"CRV1": "cluster_var"}</code></td></tr>
        </table>
      </div>

      <h3>model.emfx()</h3>
      <p>Calculate aggregated marginal effects (treatment effect estimates).</p>

      <div class="table-wrap">
        <table>
          <tr><th>Argument</th><th>Type</th><th>Description</th></tr>
          <tr><td class="param">type</td><td><code>str</code></td><td>Aggregation: <code>"simple"</code> (overall ATT), <code>"event"</code>, <code>"group"</code>, or <code>"calendar"</code></td></tr>
          <tr><td class="param">by_xvar</td><td><code>bool</code></td><td>Report separate effects by xvar levels (default False)</td></tr>
          <tr><td class="param">post_only</td><td><code>bool</code></td><td>Restrict to post-treatment periods only (default True)</td></tr>
          <tr><td class="param">compress</td><td><code>bool</code></td><td>Apply data compression for speed (default False)</td></tr>
          <tr><td class="param">vcov</td><td><code>bool</code></td><td>Calculate standard errors; set False to skip (default True)</td></tr>
          <tr><td class="param">predict</td><td><code>str</code></td><td>Prediction scale: <code>"response"</code> (default) or <code>"link"</code></td></tr>
        </table>
      </div>

      <h3>model.plot()</h3>
      <p>Generate visualizations of treatment effects.</p>

      <div class="table-wrap">
        <table>
          <tr><th>Argument</th><th>Type</th><th>Description</th></tr>
          <tr><td class="param">type</td><td><code>str</code></td><td>Plot type: <code>"event"</code>, <code>"group"</code>, or <code>"calendar"</code></td></tr>
          <tr><td class="param">style</td><td><code>str</code></td><td>Visual style: <code>"errorbar"</code> (default) or <code>"ribbon"</code></td></tr>
          <tr><td class="param">post_only</td><td><code>bool</code></td><td>Display only post-treatment periods</td></tr>
          <tr><td class="param">by_xvar</td><td><code>bool</code></td><td>Draw separate series for each xvar group</td></tr>
          <tr><td class="param">figsize</td><td><code>tuple</code></td><td>Figure dimensions as (width, height)</td></tr>
          <tr><td class="param">color</td><td><code>str</code></td><td>Color for single-group plots</td></tr>
          <tr><td class="param">colors</td><td><code>list</code></td><td>Color sequence for multi-group plots</td></tr>
        </table>
      </div>
    </section>

    <section id="requirements">
      <h2>Requirements</h2>
      <ul>
        <li>Python >= 3.9</li>
        <li>numpy >= 1.21.0</li>
        <li>pandas >= 1.3.0</li>
        <li>matplotlib >= 3.4.0</li>
        <li>pyfixest >= 0.18.0</li>
      </ul>
    </section>

    <section id="refs">
      <h2>References</h2>
      <p style="font-size: 14px; line-height: 2.2;">
        Wooldridge, J. M. (2025). <a href="https://link.springer.com/article/10.1007/s00181-024-02681-z"><em>Two-way fixed effects, the two-way Mundlak regression, and difference-in-differences estimators.</em></a> Empirical Economics, 69(5), 2545-2587.<br>
        Wooldridge, J. M. (2023). <a href="https://academic.oup.com/ectj/article/26/3/C31/7039335"><em>Simple approaches to nonlinear difference-in-differences with panel data.</em></a> The Econometrics Journal, 26(3), C31-C66.<br>
        Callaway, B. and Sant'Anna, P. H. (2021). <em>Difference-in-differences with multiple time periods.</em> Journal of Econometrics, 225(2), 200-230.<br>
        Wong, J., Forsell, E., Lewis, R., Mao, T., and Wardrop, M. (2021). <a href="https://arxiv.org/abs/2102.11297"><em>You only compress once: Optimal data compression for estimating linear models.</em></a> arXiv:2102.11297.
      </p>
    </section>

    <section id="acknowledgments">
      <h2>Acknowledgments</h2>
      <p>
        This package relies on several high-quality open-source projects. Estimation uses <a href="https://github.com/py-econometrics/pyfixest">pyfixest</a> for high-dimensional fixed effects regression. The API and methodology draw heavily from Grant McDermott's <a href="https://github.com/grantmcdermott/etwfe">etwfe</a> package for R. We thank the developers of these projects for their contributions to accessible econometric software.
      </p>
    </section>

  </div>

  <footer class="footer">
    <div>Developed with ❤️ by <a href="https://github.com/armandkapllani">Armand Kapllani</a></div>
    <div class="footer-links">
      <a href="https://github.com/armandkapllani/etwfe">GitHub</a>
      <a href="https://pypi.org/project/etwfe/">PyPI</a>
      <a href="https://pepy.tech/project/etwfe">Downloads</a>
      <a href="https://github.com/armandkapllani/etwfe/issues">Issues</a>
    </div>
  </footer>
</main>

<script>
const sidebar = document.getElementById('sidebar');
const overlay = document.getElementById('overlay');

function openSidebar() {
  sidebar.classList.add('open');
  overlay.classList.add('open');
  document.body.style.overflow = 'hidden';
}

function closeSidebar() {
  sidebar.classList.remove('open');
  overlay.classList.remove('open');
  document.body.style.overflow = '';
}

function copyCode(btn) {
  const code = btn.closest('.code-block').querySelector('code').innerText;
  navigator.clipboard.writeText(code);
  btn.textContent = 'Copied!';
  setTimeout(() => btn.textContent = 'Copy', 1500);
}

// Close sidebar on escape
document.addEventListener('keydown', (e) => {
  if (e.key === 'Escape') closeSidebar();
});
</script>

</body>
</html>
